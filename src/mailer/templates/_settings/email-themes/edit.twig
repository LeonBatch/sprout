{% extends "sprout-module-core/_layouts/settings" %}
{% import "sprout-module-core/_macros/sproutcp" as sproutCp %}
{% import "_includes/forms" as forms %}

{% set module = sprout.modules.mailer %}
{% set settings = module.getSettings() %}

{% set currentSubNavKey = 'email-themes' %}

{% set crumbs = [
    { label: "Settings"|t('sprout-module-mailer'), url: cpUrl('sprout/settings') },
    { label: "Email Themes"|t('sprout-module-mailer'), url: cpUrl('sprout/settings/email-themes') }
] %}

{% set fullPageForm = true %}

{% block actionButton %}

    {#    {% if emailTheme.isEditable() %} #}
    <div class="buttons">
        <input type="submit" class="btn submit" value="{{ 'Save'|t('sprout-module-mailer') }}">
    </div>
    {#    {% endif %} #}

{% endblock %}

{% block content %}

    {{ actionInput('sprout-module-mailer/email-themes/save') }}
    {{ redirectInput('sprout/settings/email-themes') }}

    {{ hiddenInput('uid', emailTheme.uid) }}
    {{ hiddenInput('type', className(emailTheme)) }}

    {{ forms.textField({
        label: "Name"|t('sprout-module-mailer'),
        instructions: "How you will refer to this Email Theme."|t('sprout-module-mailer'),
        id: 'name',
        name: 'name',
        value: emailTheme.name,
        errors: emailTheme.getErrors('name'),
        warning: sproutConfigWarning(module, 'name'),
        required: true,
        first: true,
    }) }}

    {{ forms.autosuggestField({
        label: "Email Template (HTML)"|t('sprout-module-mailer'),
        instructions: "The template that will be used to render your HTML email."|t('sprout-module-mailer'),
        id: 'htmlEmailTemplate',
        name: 'htmlEmailTemplate',
        suggestEnvVars: false,
        suggestions: craft.cp.getTemplateSuggestions(),
        placeholder: "_emails/theme/email.twig"|t('sprout-module-mailer'),
        value: emailTheme.htmlEmailTemplate ?? null,
        errors: emailTheme.getErrors('htmlEmailTemplate'),
        required: true,
        disabled: not emailTheme.isEditable(),
    }) }}

    {{ forms.autosuggestField({
        label: "Email Template (Text)"|t('sprout-module-mailer'),
        instructions: "Leave blank to render the text email by converting the HTML template to Markdown."|t('sprout-module-mailer'),
        id: 'textEmailTemplate',
        name: 'textEmailTemplate',
        suggestEnvVars: false,
        suggestions: craft.cp.getTemplateSuggestions(),
        placeholder: emailTheme.isEditable() ? "_emails/theme/email.txt"|t('sprout-module-mailer') : '',
        value: emailTheme.textEmailTemplate ?? null,
        errors: emailTheme.getErrors('textEmailTemplate'),
        disabled: not emailTheme.isEditable(),
    }) }}

    {#    {{ forms.autosuggestField({ #}
    {#        label: "Copy/Paste Email Template Folder"|t('sprout-module-mailer'), #}
    {#        instructions: "The templates that will be used to display your email."|t('sprout-module-mailer'), #}
    {#        id: 'copyPasteEmailTemplatePath', #}
    {#        name: 'copyPasteEmailTemplatePath', #}
    {#        suggestEnvVars: false, #}
    {#        suggestions: sproutTemplateFolderSuggestions(), #}
    {#        placeholder: "_emails/custom-folder"|t('sprout-module-mailer'), #}
    {#        value: emailTheme.copyPasteEmailTemplatePath ?? null, #}
    {#        disabled: not emailTheme.isEditable(), #}
    {#    }) }} #}

    <hr>

    {% set fieldLayoutInstructions = "The content fields that can be used in this email theme."|t('sprout-module-mailer') %}

    {% if emailTheme.isEditable() %}

        {{ forms.fieldLayoutDesignerField({
            instructions: fieldLayoutInstructions,
            fieldLayout: emailTheme.getFieldLayout(),
            required: true,
            customizableTabs: false,
            customizableUi: false,
            errors: emailTheme.getErrors('fieldLayout'),
        }) }}

    {% else %}

        {% set tabs = emailTheme.getFieldLayout().getTabs() %}

        <div class="field">
            <div class="heading">
                <label>{{ "Field Layout"|t('sprout-module-mailer') }}</label>
            </div>
            <div class="instructions">
                <p>{{ fieldLayoutInstructions }}</p>
            </div>
            <div class="layoutdesigner">
                <div class="fld-workspace">
                    <div class="fld-tabs" style="position: relative;">
                        {% for tab in tabs %}
                            <div class="fld-tab last" style="height: 144px;">
                                <div class="tabs">
                                    <div class="tab"><span>{{ tab.name }}</span></div>
                                </div>
                                <div class="fld-tabcontent">
                                    {% for element in tab.elements %}
                                        {% if className(element) is same as 'craft\\fieldlayoutelements\\Tip' %}
                                            <div class="fld-ui-element fld-element" style="display: flex;">
                                                <div class="fld-element-icon"><!--?xml version="1.0" encoding="utf-8"?-->
                                                    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 256 448" style="enable-background: new 0 0 256 448;" xml:space="preserve" aria-hidden="true">
<path d="M184,144c0,4.2-3.8,8-8,8s-8-3.8-8-8c0-17.2-26.8-24-40-24c-4.2,0-8-3.8-8-8s3.8-8,8-8C151.2,104,184,116.2,184,144z
	 M224,144c0-50-50.8-80-96-80s-96,30-96,80c0,16,6.5,32.8,17,45c4.8,5.5,10.2,10.8,15.2,16.5C82,226.8,97,251.8,99.5,280h57
	c2.5-28.2,17.5-53.2,35.2-74.5c5-5.8,10.5-11,15.2-16.5C217.5,176.8,224,160,224,144z M256,144c0,25.8-8.5,48-25.8,67
	s-40,45.8-42,72.5c7.2,4.2,11.8,12.2,11.8,20.5c0,6-2.2,11.8-6.2,16c4,4.2,6.2,10,6.2,16c0,8.2-4.2,15.8-11.2,20.2
	c2,3.5,3.2,7.8,3.2,11.8c0,16.2-12.8,24-27.2,24c-6.5,14.5-21,24-36.8,24s-30.2-9.5-36.8-24c-14.5,0-27.2-7.8-27.2-24
	c0-4,1.2-8.2,3.2-11.8c-7-4.5-11.2-12-11.2-20.2c0-6,2.2-11.8,6.2-16c-4-4.2-6.2-10-6.2-16c0-8.2,4.5-16.2,11.8-20.5
	c-2-26.8-24.8-53.5-42-72.5S0,169.8,0,144C0,76,64.8,32,128,32S256,76,256,144z"></path>
</svg>
                                                </div>
                                                <div class="field-name">
                                                    <div class="fld-element-label"><h4>Tip</h4></div>
                                                </div>
                                            </div>
                                        {% else %}
                                            <div class="fld-field fld-required fld-element">
                                                <div class="field-name">
                                                    <div class="fld-element-label"><h4>{{ element.label }}</h4>
                                                        {% if element.required %}
                                                            <div class="fld-required-indicator" title="This field is required" aria-label="This field is required" data-icon="asterisk"></div>
                                                        {% endif %}
                                                    </div>
                                                    <div class="fld-attribute">
                                                        <div class="smalltext light code">{{ element.attribute }}</div>
                                                    </div>
                                                </div>
                                                <a role="button" tabindex="0" class="settings icon disabled" style="cursor:inherit;" title="Edit"></a>
                                            </div>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

    {% endif %}

    {{ forms.textField({
        label: "Theme Type"|t('sprout-module-mailer'),
        value: emailTheme.displayName(),
        disabled: true,
    }) }}

{% endblock %}

{# {% js "new Craft.HandleGenerator('#name', '#handle');" %} #}
