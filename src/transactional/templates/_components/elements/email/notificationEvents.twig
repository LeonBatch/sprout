{% import "_includes/forms" as forms %}

{% set selectedNotificationEvent = className(notificationEvent) %}

<div x-data="NotificationEventTip('{{ selectedNotificationEvent|e('js') }}')">
    {{ forms.selectField({
        id: "notificationEvent",
        name: "emailTypeSettings[eventId]",
        label: 'Event'|t('sprout-module-mailer'),
        instructions: 'The event that will trigger your notification.'|t('sprout-module-mailer'),
        options: eventOptions,
        value: selectedNotificationEvent,
        required: true,
        toggle: true,
        targetPrefix: 'notification-event-',
        inputAttributes: {
            'x-on:change': 'selectedNotificationEvent = $event.target.value'
        }
    }) }}

    {% for type, event in events %}
        {% if event.settings is not empty %}
            <div id="notification-event-{{ className(event)|id }}" class="notification-event-wrapper hidden">
                {% namespace 'emailTypeSettings[eventSettings][' ~ type ~ ']' %}
                    {% if className(event) is same as className(notificationEvent) %}
                        {{ notificationEvent.getSettingsHtml()|raw }}
                    {% else %}
                        {{ event.getSettingsHtml()|raw }}
                    {% endif %}
                {% endnamespace %}
            </div>
        {% endif %}

        {% if event.settings is not empty %}
            {% set eventTipHtml = event.getTipHtml() %}

            {% if currentUser.admin and eventTipHtml %}
                <template x-teleport="#sprout-notification-event-tip">

                    <fieldset
                        x-show="selectedNotificationEvent === '{{ className(event)|e('js') }}'"
                        class="sprout-sidebar-info meta"
                        style="margin-top:0;margin-bottom:18px!important;">
                        {{ eventTipHtml|markdown }}
                    </fieldset>
                </template>
            {% endif %}
        {% endif %}
    {% endfor %}

</div>

{% do sprout.modules.core.vite.register('core/SproutCp.js', false, {
    'depends': [
        'craft\\web\\assets\\cp\\CpAsset'
    ]
}) %}
{% do sprout.modules.core.vite.register('transactional/NotificationEvents.js', false) %}