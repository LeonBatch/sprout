import{m}from"./module.esm-e3630760.js";let f=$("#sprout-relations-modal"),b=new Garnish.Modal(f,{autoShow:!1,closeOtherModals:!1,resizable:!0,onShow:function(){let e={elementId:document.getElementById("sprout-relations-btn").dataset.elementId};Craft.sendActionRequest("POST","sprout-module-core/source-element-relations/get-relations",{data:e}).then(t=>{t.data.success&&f.html(t.data.html)}).catch(()=>{})},onHide:function(){}}),p=document.querySelector("#sprout-relations-btn");p!==null&&p.addEventListener("click",function(i){i.preventDefault(),b.show()},!1);const F={dragStartLayoutTabNav:function(i){i.dataTransfer.setData("sprout/origin-page-tab-uid",i.target.dataset.tabUid),window.FormBuilder.dragOrigin=window.FormBuilder.DragOrigins.layoutTabNav,window.FormBuilder.isDraggingTabUid=i.target.dataset.tabUid},dragEndLayoutTabNav:function(i){window.FormBuilder.dragOrigin=null,window.FormBuilder.isDraggingTabUid=null,window.FormBuilder.isDragOverTabUid=null},dragEnterLayoutTabNav:function(i){i.target.classList.add("no-pointer-events")},dragLeaveLayoutTabNav:function(i){i.target.classList.remove("no-pointer-events")},dragOverLayoutTabNav:function(i){let e=window.FormBuilder;e.dragOrigin,e.DragOrigins.layoutTabNav,(e.dragOrigin===e.DragOrigins.sourceField||e.dragOrigin===e.DragOrigins.layoutField)&&setTimeout(function(){e.selectedTabUid=i.target.dataset.tabUid},1e3)},dropOnLayoutTabNav:function(i){let e=window.FormBuilder;i.target.classList.remove("no-pointer-events");let t=i.dataTransfer.getData("sprout/origin-page-tab-uid"),a=i.target.dataset.tabUid;if(e.dragOrigin===e.DragOrigins.layoutTabNav&&(e.updateTabPosition(t,a),e.selectedTabUid=t),e.dragOrigin===e.DragOrigins.sourceField){let l=i.dataTransfer.getData("sprout/field-type");e.addFieldToLayoutTab(l)}e.dragOrigin===e.DragOrigins.layoutField&&e.updateFieldPosition(t,a,self.isDraggingFormFieldUid)},dragOverLayoutTabBody:function(i){i.dataTransfer.types.includes("sprout/field-type")&&event.preventDefault()},dragLeaveLayoutTabBody:function(i){window.FormBuilder.isDragOverTabUid=null},dragEnterLayoutTabBody:function(i){let e=window.FormBuilder;e.isDragOverTabUid=e.selectedTabUid},dropOnLayoutTabBody:function(i){let e=window.FormBuilder,t=e.FieldLayoutHelper;i.target.classList.remove("no-pointer-events");let a=i.dataTransfer.getData("sprout/field-type"),l=i.dataTransfer.getData("sprout/origin-page-tab-uid");if(e.dragOrigin===e.DragOrigins.sourceField){t.addFieldToLayoutTab(a);let o=t.getFieldByType(a),n=t.getLayoutElement(o.field.uid,o.field,o.uiSettings);t.editFieldLayoutElement(n)}if(e.dragOrigin===e.DragOrigins.layoutField){let o=i.target.dataset.fieldUid;t.updateFieldPosition(l,e.selectedTabUid,e.isDraggingFormFieldUid,o)}},dragStartSourceField:function(i){window.FormBuilder.dragOrigin=window.FormBuilder.DragOrigins.sourceField,i.dataTransfer.setData("sprout/field-type",i.target.dataset.type)},dragEndSourceField:function(i){window.FormBuilder.isDraggingFormFieldUid=null,window.FormBuilder.isDragOverFormFieldUid=null},dragStartLayoutField:function(i){let e=window.FormBuilder;i.dataTransfer.setData("sprout/origin-page-tab-uid",e.selectedTabUid),i.dataTransfer.setData("sprout/field-type",i.target.dataset.type),e.dragOrigin=e.DragOrigins.layoutField,e.isDraggingTabUid=i.target.dataset.tabUid,e.isDraggingFormFieldUid=i.target.dataset.fieldUid},dragEndLayoutField:function(i){window.FormBuilder.isDraggingFormFieldUid=null,window.FormBuilder.isDragOverFormFieldUid=null},dragEnterLayoutField:function(i){i.target.classList.add("no-pointer-events")},dragOverLayoutField:function(i){i.dataTransfer.types.includes("sprout/field-type")&&event.preventDefault()},dragLeaveLayoutField:function(i){i.target.classList.remove("no-pointer-events")},dropOnExistingLayoutField:function(i){let e=window.FormBuilder;i.target.classList.remove("no-pointer-events");let t=i.dataTransfer.getData("sprout/field-type"),a=i.dataTransfer.getData("sprout/origin-page-tab-uid"),l=i.target.dataset.tabUid,o=i.target.dataset.fieldUid;e.dragOrigin===e.DragOrigins.sourceField&&e.addFieldToLayoutTab(t,o),e.dragOrigin===e.DragOrigins.layoutField&&e.updateFieldPosition(a,l,self.isDraggingFormFieldUid,o)},dragEnterFieldLayoutEndZone:function(i){},dragLeaveFieldLayoutEndZone:function(i){},isOverFieldLayoutEndZone:function(i){i.dataTransfer.types.includes("sprout/field-type")&&event.preventDefault()},dropOnLayoutEndZone:function(i){let e=window.FormBuilder,t=e.FieldLayoutHelper;i.target.classList.remove("no-pointer-events");let a=i.dataTransfer.getData("sprout/field-type"),l=i.dataTransfer.getData("sprout/origin-page-tab-uid"),o=i.target.dataset.tabUid,n=i.target.dataset.fieldUid;e.dragOrigin===e.DragOrigins.sourceField&&t.addFieldToLayoutTab(a),e.dragOrigin===e.DragOrigins.layoutField&&t.updateFieldPosition(l,o,self.isDraggingFormFieldUid,n)}},y={get fieldLayoutInputValue(){let i=window.FormBuilder,e={};if(i.tabs.length&&!i.tabs[0].elements.length)return[];let t=[];for(const a of i.tabs){let l=[];for(const o of a.elements){let n=this.getFormFieldAttributes(o);l.push(n)}t.push({id:a.uid,uid:a.uid,name:a.name,sortOrder:null,userCondition:null,elementCondition:null,elements:l})}return e.tabs=t,JSON.stringify(e)},getFormFieldAttributes(i){const{uiSettings:e,...t}=i;return t},getTabIndexByTabUid(i){return window.FormBuilder.tabs.findIndex(e=>e.uid===i)},updateTabSettings(i,e){let t=window.FormBuilder,a=this.getTabIndexByTabUid(i);Object.entries(e).forEach(([l,o])=>{t.tabs[a][l]=o}),t.tabs[a].name||(t.tabs[a].name="Page")},updateTabPosition(i,e=null){let t=window.FormBuilder,a=this.getTabIndexByTabUid(e),l=this.getTabIndexByTabUid(i),o=t.tabs[l];t.tabs.splice(l,1),e?t.tabs.splice(a,0,o):t.tabs.push(o),t.lastUpdatedTabUid=o.uid},getFieldIndexByFieldUid(i,e){return i.elements.findIndex(t=>t.fieldUid===e)},getFieldByType(i){return window.FormBuilder.sourceFields.filter(e=>e.field.type===i)[0]??null},addFieldToLayoutTab(i,e=null){let t=window.FormBuilder,a=this.getFieldByType(i);a.field.type=i,t.dragOrigin===t.DragOrigins.sourceField&&(a.field.name=a.uiSettings.displayName,a.field.handle=a.uiSettings.defaultHandle+"_"+Craft.randomString(4),a.field.uid=Craft.uuid()),t.dragOrigin,t.DragOrigins.layoutField;let l=a.field.uid,o=this.getTabIndexByTabUid(t.selectedTabUid),n=this.getLayoutElement(l,a.field,a.uiSettings);if(t.tabs[o].elements.push(n),e){let r=this.getTabIndexByTabUid(t.selectedTabUid),d=t.tabs[r],u=this.getFieldIndexByFieldUid(d,l),s=d.elements[u];d.elements.splice(u,1);let g=this.getFieldIndexByFieldUid(d,e);d.elements.splice(g,0,s),t.tabs[r]=d,t.lastUpdatedFormFieldUid=s.uid,this.resetLastUpdated()}},updateFieldPosition(i,e,t,a=null){let l=window.FormBuilder,o=this.getTabIndexByTabUid(i),n=l.tabs[o],r=this.getTabIndexByTabUid(e),d=l.tabs[r];d||(d=n);let u=this.getFieldIndexByFieldUid(n,t),s=n.elements[u];if(n.elements.splice(u,1),a){let g=this.getFieldIndexByFieldUid(d,a);d.elements.splice(g,0,s)}else d.elements.push(s);l.tabs[r]=d,l.lastUpdatedFormFieldUid=s.uid,this.resetLastUpdated()},editFormTab(i){let e=this,t=window.FormBuilder;t.editTabUid=i.uid;let a=new Craft.CpScreenSlideout("sprout-module-forms/form-builder/edit-form-tab-slideout-via-cp-screen",{hasTabs:!1,params:{formId:t.formId,tab:i}});const l=this.getRemoveButtonHtml();a.$footer.find(".flex-grow").before(l),a.$footer.find(".submit").addClass("secondary"),l.on("click",()=>{if(t.tabs.length===1){Craft.cp.displayNotice(Craft.t("sprout-module-forms","Form must contain at least one tab."));return}let o=e.getTabIndexByTabUid(t.selectedTabUid),n=o-1>=0?t.tabs[o-1].uid:t.tabs[o+1].uid;t.tabs.splice(o,1);let r=e.getTabIndexByTabUid(n);t.selectedTabUid=t.tabs[r].uid,t.editTabUid=t.selectedTabUid,a.close()}),a.on("submit",o=>{this.updateTabSettings(t.editTabUid,o.response.data.tab)}),a.on("close",()=>{t.editTabUid=null})},editFieldLayoutElement(i){let e=window.FormBuilder;e.editFieldUid=i.fieldUid;let t=new Craft.CpScreenSlideout("sprout-module-forms/form-builder/edit-form-field-slideout-via-cp-screen",{hasTabs:!0,tabManager:"",params:{formId:e.formId,layoutElement:i}});const a=this.getRemoveButtonHtml();t.$footer.find(".flex-grow").before(a),t.$footer.find(".submit").addClass("secondary"),a.on("click",()=>{t.close()}),t.on("submit",l=>{this.updateFieldLayoutElement(e.editFieldUid,l.response.data.layoutElement)}),t.on("close",()=>{e.editFieldUid=null})},getLayoutElement(i,e,t){return{type:"BarrelStrength\\Sprout\\forms\\submissions\\CustomFormField",required:!1,width:100,uid:Craft.uuid(),userCondition:null,elementCondition:null,fieldUid:i,field:e,uiSettings:t}},updateFieldLayoutElement(i,e){let t=window.FormBuilder,a=this.getTabIndexByTabUid(t.selectedTabUid),l=t.tabs[a],o=this.getFieldIndexByFieldUid(l,i),n=l.elements[o];n.required=e.required,n.field=Object.assign(n.field,e.field),l.elements[o]=n},resetLastUpdated(){setTimeout(function(){window.FormBuilder.lastUpdatedFormFieldUid=null},300)},getRemoveButtonHtml:function(){const i=Craft.ui.createButton({class:"icon",label:Craft.t("app","Remove"),spinner:!0});return i.attr("data-icon","trash"),i}},T=i=>({DragDropHelper:F,FieldLayoutHelper:y,formId:i,lastUpdatedFormFieldUid:null,sourceFields:[],tabs:[],fields:[],uiSettings:[],fieldLayoutUid:null,selectedTabUid:null,editTabUid:null,editFieldUid:null,dragOrigin:null,DragOrigins:{sourceField:"source-field",layoutField:"layout-field",layoutTabNav:"layout-tab-nav"},isDraggingTabUid:null,isDragOverTabUid:null,isDraggingFormFieldUid:null,isDragOverFormFieldUid:null,init(){let e=this;Craft.sendActionRequest("POST","sprout-module-forms/form-builder/get-submission-field-layout",{data:{formId:this.formId}}).then(a=>{e.tabs=a.data.layout.tabs,e.fieldLayoutUid=a.data.layout.uid,e.selectedTabUid=e.tabs[0].uid??null}).catch(()=>{}),window.FormBuilder=this;let t=JSON.parse(this.$refs.formBuilder.dataset.sourceFields);for(const a of t)this.sourceFields.push(a)},getFieldsByGroup(e){return window.FormBuilder.sourceFields.filter(t=>t.groupName===e)},addFormPageButton(){let e=Craft.uuid(),t={uid:e,name:"New Page",userCondition:null,elementCondition:null,elements:[]};this.tabs.push(t),this.selectedTabUid=e}}),h=i=>({element:i,dragHover:!1,init(){},sourceHtml(){return`<div
class="source-field"
draggable="true"
x-bind:class="[dragHover ? 'drag-hover' : '', element.field.sortOrder % 2 == 0 ? 'even' : 'odd']"
x-on:mouseover="dragHover = true"
x-on:mouseleave="dragHover = false"
x-on:dragstart.self="DragDropHelper.dragStartSourceField"
x-on:dragend.self="DragDropHelper.dragEndSourceField"
x-bind:data-type="element.field.type"><h3><span x-html="element.uiSettings.icon" class="sproutforms-icon"></span><span x-text="element.field.name" x-bind:data-handle="element.field.name" class="sproutforms-sourcefield-name"></span></h3></div>`}});window.Alpine=m;m.data("FormBuilder",T);m.data("FormField",h);m.start();let c=window.Sprout||{};c.formNameForm=function(){let i=$("#form-name-form"),e=document.getElementById("name-field");i.on("submit",()=>e.value.length===0?(Garnish.shake(i),e.focus(),!1):(i.submit(),!0))};document.readyState!=="loading"?c.formNameForm():document.addEventListener("DOMContentLoaded",c.formNameForm);/*
 * @link https://sprout.barrelstrengthdesign.com
 * @copyright Copyright (c) Barrel Strength Design LLC
 * @license https://craftcms.github.io/license
 */class S{constructor(e){}disableOptions(){const e=this,a={integrationId:$("#integrationId").val()};return Craft.postActionRequest("sprout-module-forms/form-integration-settings/get-source-form-fields",a,$.proxy(function(l,o){if(o==="success"&&l.success){const r=l.sourceFormFields;$("tbody .formField").each(function(d){const u=$(this);u.empty();const s=r[d].label,g=r[d].value;u.append('<div style="display:none;"><select readonly name="settings['+e.integrationType+"][fieldMapping]["+d+'][sourceFormField]"><option selected value="'+g+'">'+s+'</option></select></div><div style="padding: 7px 10px;font-size: 12px;color:#8f98a3;">'+s+' <span class="code">('+g+")</span></div>")})}else Craft.cp.displayError(Craft.t("sprout","Unable to get the Form fields"))},this)),null}updateAllFieldSelects(){const t="table#settings-"+this.integrationType.replace(/\\/g,"-")+"-fieldMapping tr";$(t).find("td:eq(2),th:eq(2)").remove(),$(t).find("td:eq(0),th:eq(0)").css("width","50%"),$(t).find("td:eq(1),th:eq(1)").css("width","50%");const a=this.getCurrentRows("tbody .targetFields"),l=$("#integrationId").closest("form").serialize(),o=this;Craft.sendActionRequest("POST","sprout-module-forms/form-integration-settings/get-target-integration-fields",{data:l}).then(n=>{if(textStatus==="success"&&n.success){const d=n.targetIntegrationFields;if(d.length===0)return!1;a.each(function(u){const s=$(this).find("select"),g=d[u];o.appendFieldsToSelect(s,g)})}else Craft.cp.displayError(Craft.t("sprout","Unable to get the Form fields"))},this)}getCurrentRows(e=null){return e===null&&(e="tbody .formField"),$(e)}appendFieldsToSelect(e,t){e.empty();let a="",l=!1;e.append('<option value="">'+Craft.t("sprout","None")+"</option>");for(let o=0;o<t.length;o++){const n=t[o];let r="";const d=o===t.length-1;"optgroup"in n||("selected"in n&&(r="selected"),a+="<option "+r+' value="'+n.value+'">'+n.label+"</option>"),("optgroup"in n&&l||d&&l)&&(a+="</optgroup>",l=!1),"optgroup"in n&&(a+='<optgroup label="'+n.optgroup+'">',l=!0)}e.append(a)}}window.SproutFormsIntegration=S;class w{constructor(e,t){this.formId=e,this.siteId=t,this.newSelectField=document.getElementById("new-integration"),this.initLinkSlideout(),this.initNewSlideout()}initLinkSlideout(){let e=this;document.querySelectorAll("#integrations-field .edit-element-col a").forEach(function(a){a.addEventListener("click",function(l){l.preventDefault(),l.target.closest("tr").getAttribute("data-element-id"),Craft.createElementEditor("BarrelStrength\\Sprout\\datastudio\\components\\elements\\DataSetElement",{elementId,siteId:this.siteId,elementType:"BarrelStrength\\Sprout\\datastudio\\components\\elements\\DataSetElement"}).on("submit",()=>{e.replaceTable()})})})}initNewSlideout(){let e=this;if(this.newSelectField){let t=Craft.uuid();this.newSelectField.addEventListener("change",function(a){a.target.value&&e.createSlideout(t,a.target.value)})}}createSlideout(e,t){let a=this,l=window.FormBuilder,o=l.integrationsFormFieldMetadata.length>0?JSON.parse(l.integrationsFormFieldMetadata):[];Craft.sendActionRequest("POST","sprout-module-forms/form-integrations/edit-integration-slideout",{data:{formId:a.formId,integrationUid:e,integrationTypeUid:t,integrationsFormFieldMetadata:o}}).then(n=>{if(n.data.success){const r=new Craft.Slideout(n.data.html,{containerElement:"form",containerAttributes:{action:"sprout-module-forms/form-integration-settings/save-integration",method:"post",novalidate:"",class:"fld-element-settings"}});Craft.appendBodyHtml(n.data.slideoutJs),r.on("submit",()=>{a.replaceTable()}),r.on("close",()=>{this.newSelectField&&(this.newSelectField.value="")})}})}replaceTable(){let e=this;Craft.sendActionRequest("POST","sprout-module-forms/form-integrations/edit-integration-slideout",{data:{elementId:e.elementId}}).then(t=>{$("#integrations-field").html(t.data.html),e.initLinkSlideout(),e.initNewSlideout()})}}window.IntegrationsRelationsTable=w;class B{constructor(e,t){this.elementId=e,this.siteId=t,this.initLinkElementSlideout(),this.initNewElementSlideout()}initLinkElementSlideout(){let e=this;document.querySelectorAll("#data-source-relations-field .edit-element-col a").forEach(function(a){a.addEventListener("click",function(l){l.preventDefault();let o=l.target.closest("tr").getAttribute("data-element-id");Craft.createElementEditor("BarrelStrength\\Sprout\\datastudio\\components\\elements\\DataSetElement",{elementId:o,siteId:this.siteId,elementType:"BarrelStrength\\Sprout\\datastudio\\components\\elements\\DataSetElement"}).on("submit",()=>{e.replaceTable()})})})}initNewElementSlideout(){let e=this,t=document.getElementById("new-data-set");t&&t.addEventListener("change",function(a){Craft.sendActionRequest("POST","sprout-module-data-studio/data-set/create-data-set",{data:{type:a.target.value}}).then(l=>{l.data.success&&Craft.createElementEditor("BarrelStrength\\Sprout\\datastudio\\components\\elements\\DataSetElement",{elementId:l.data.elementId,siteId:l.data.siteId,draftId:l.data.draftId,elementType:"BarrelStrength\\Sprout\\datastudio\\components\\elements\\DataSetElement"}).on("submit",()=>{e.replaceTable()})})})}replaceTable(){let e=this;Craft.sendActionRequest("POST","sprout-module-data-studio/form-relations-table/get-relations-table",{data:{elementId:e.elementId}}).then(t=>{$("#data-source-relations-field").html(t.data.html),e.initLinkElementSlideout(),e.initNewElementSlideout()})}}window.DataSourceRelationsTable=B;class v{constructor(e,t){this.elementId=e,this.siteId=t,this.initLinkElementSlideout(),this.initNewElementSlideout()}initLinkElementSlideout(){let e=this;document.querySelectorAll("#notification-event-relations-field .edit-element-col a").forEach(function(a){a.addEventListener("click",function(l){l.preventDefault();let o=l.target.closest("tr").getAttribute("data-element-id");Craft.createElementEditor("BarrelStrength\\Sprout\\mailer\\components\\elements\\email\\EmailElement",{elementId:o,siteId:this.siteId,elementType:"BarrelStrength\\Sprout\\mailer\\components\\elements\\email\\EmailElement"}).on("submit",()=>{e.replaceTable()})})})}initNewElementSlideout(){let e=this,t=document.getElementById("new-transactional-email");t&&t.addEventListener("change",function(a){Craft.sendActionRequest("POST","sprout-module-mailer/email/create-email",{data:{emailTypeUid:a.target.value,emailVariant:"BarrelStrength\\Sprout\\transactional\\components\\emailvariants\\TransactionalEmailVariant",emailVariantSettings:{eventId:"BarrelStrength\\Sprout\\forms\\components\\notificationevents\\SaveSubmissionNotificationEvent"}}}).then(l=>{l.data.success&&Craft.createElementEditor("BarrelStrength\\Sprout\\mailer\\components\\elements\\email\\EmailElement",{elementId:l.data.elementId,siteId:l.data.siteId,draftId:l.data.draftId,elementType:"BarrelStrength\\Sprout\\mailer\\components\\elements\\email\\EmailElement"}).on("submit",()=>{e.replaceTable()})})})}replaceTable(){let e=this;Craft.sendActionRequest("POST","sprout-module-transactional/form-relations-table/get-relations-table",{data:{elementId:e.elementId}}).then(t=>{$("#notification-event-relations-field").html(t.data.html),e.initLinkElementSlideout(),e.initNewElementSlideout()})}}window.NotificationEventsRelationsTable=v;
//# sourceMappingURL=forms-3e427546.js.map
