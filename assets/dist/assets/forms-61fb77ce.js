import{m}from"./module.esm-e3630760.js";let f=$("#sprout-relations-modal"),b=new Garnish.Modal(f,{autoShow:!1,closeOtherModals:!1,resizable:!0,onShow:function(){let e={elementId:document.getElementById("sprout-relations-btn").dataset.elementId};Craft.sendActionRequest("POST","sprout-module-core/source-element-relations/get-relations",{data:e}).then(i=>{i.data.success&&f.html(i.data.html)}).catch(()=>{})},onHide:function(){}}),p=document.querySelector("#sprout-relations-btn");p!==null&&p.addEventListener("click",function(t){t.preventDefault(),b.show()},!1);const F={dragStartLayoutTabNav:function(t){t.dataTransfer.setData("sprout/origin-page-tab-uid",t.target.dataset.tabUid),window.FormBuilder.dragOrigin=window.FormBuilder.DragOrigins.layoutTabNav,window.FormBuilder.isDraggingTabUid=t.target.dataset.tabUid},dragEndLayoutTabNav:function(t){window.FormBuilder.dragOrigin=null,window.FormBuilder.isDraggingTabUid=null,window.FormBuilder.isDragOverTabUid=null},dragEnterLayoutTabNav:function(t){t.target.classList.add("no-pointer-events")},dragLeaveLayoutTabNav:function(t){t.target.classList.remove("no-pointer-events")},dragOverLayoutTabNav:function(t){let e=window.FormBuilder;e.dragOrigin,e.DragOrigins.layoutTabNav,(e.dragOrigin===e.DragOrigins.sourceField||e.dragOrigin===e.DragOrigins.layoutField)&&setTimeout(function(){e.selectedTabUid=t.target.dataset.tabUid},1e3)},dropOnLayoutTabNav:function(t){let e=window.FormBuilder,i=e.FieldLayoutHelper;t.target.classList.remove("no-pointer-events");let a=t.dataTransfer.getData("sprout/origin-page-tab-uid"),l=t.target.dataset.tabUid;if(e.dragOrigin===e.DragOrigins.layoutTabNav&&(i.updateTabPosition(a,l),e.selectedTabUid=a),e.dragOrigin===e.DragOrigins.sourceField){let o=t.dataTransfer.getData("sprout/field-type");i.addFieldToLayoutTab(o)}e.dragOrigin===e.DragOrigins.layoutField&&i.updateFieldLayoutElementPosition(a,l,e.isDraggingFormFieldUid)},dragOverLayoutTabBody:function(t){t.dataTransfer.types.includes("sprout/field-type")&&event.preventDefault()},dragLeaveLayoutTabBody:function(t){window.FormBuilder.isDragOverTabUid=null},dragEnterLayoutTabBody:function(t){let e=window.FormBuilder;e.isDragOverTabUid=e.selectedTabUid},dropOnLayoutTabBody:function(t){let e=window.FormBuilder,i=e.FieldLayoutHelper;t.target.classList.remove("no-pointer-events");let a=t.dataTransfer.getData("sprout/field-type"),l=t.dataTransfer.getData("sprout/origin-page-tab-uid");if(e.dragOrigin===e.DragOrigins.sourceField){i.addFieldToLayoutTab(a);let o=i.getFieldByType(a),d=i.getLayoutElement(o.field.uid,o.field,o.uiSettings);i.editFieldLayoutElement(d)}if(e.dragOrigin===e.DragOrigins.layoutField){let o=t.target.dataset.fieldUid;i.updateFieldLayoutElementPosition(l,e.selectedTabUid,e.isDraggingFormFieldUid,o)}},dragStartSourceField:function(t){window.FormBuilder.dragOrigin=window.FormBuilder.DragOrigins.sourceField,t.dataTransfer.setData("sprout/field-type",t.target.dataset.type)},dragEndSourceField:function(t){window.FormBuilder.isDraggingFormFieldUid=null,window.FormBuilder.isDragOverFormFieldUid=null},dragStartLayoutField:function(t){let e=window.FormBuilder;t.dataTransfer.setData("sprout/origin-page-tab-uid",e.selectedTabUid),t.dataTransfer.setData("sprout/field-type",t.target.dataset.type),e.dragOrigin=e.DragOrigins.layoutField,e.isDraggingTabUid=t.target.dataset.tabUid,e.isDraggingFormFieldUid=t.target.dataset.fieldUid},dragEndLayoutField:function(t){window.FormBuilder.isDraggingFormFieldUid=null,window.FormBuilder.isDragOverFormFieldUid=null},dragEnterLayoutField:function(t){t.target.classList.add("no-pointer-events")},dragOverLayoutField:function(t){t.dataTransfer.types.includes("sprout/field-type")&&(window.FormBuilder.isDragOverFormFieldUid=t.target.dataset.fieldUid,event.preventDefault())},dragLeaveLayoutField:function(t){t.target.classList.remove("no-pointer-events")},dropOnExistingLayoutField:function(t){let e=window.FormBuilder,i=e.FieldLayoutHelper;t.target.classList.remove("no-pointer-events");let a=t.dataTransfer.getData("sprout/field-type"),l=t.dataTransfer.getData("sprout/origin-page-tab-uid"),o=t.target.dataset.tabUid,d=t.target.dataset.fieldUid;e.dragOrigin===e.DragOrigins.sourceField&&i.addFieldToLayoutTab(a,d),e.dragOrigin===e.DragOrigins.layoutField&&i.updateFieldLayoutElementPosition(l,o,e.isDraggingFormFieldUid,d)},dragEnterFieldLayoutEndZone:function(t){},dragLeaveFieldLayoutEndZone:function(t){},isOverFieldLayoutEndZone:function(t){t.dataTransfer.types.includes("sprout/field-type")&&event.preventDefault()},dropOnLayoutEndZone:function(t){let e=window.FormBuilder,i=e.FieldLayoutHelper;t.target.classList.remove("no-pointer-events");let a=t.dataTransfer.getData("sprout/field-type"),l=t.dataTransfer.getData("sprout/origin-page-tab-uid"),o=t.target.dataset.tabUid,d=t.target.dataset.fieldUid;e.dragOrigin===e.DragOrigins.sourceField&&i.addFieldToLayoutTab(a),e.dragOrigin===e.DragOrigins.layoutField&&i.updateFieldLayoutElementPosition(l,o,e.isDraggingFormFieldUid,d)}},y={get submissionFieldLayoutConfig(){let t=window.FormBuilder,e={};if(t.tabs.length&&!t.tabs[0].fields.length)return[];let i=[];for(const a of t.tabs){let l=[];for(const o of a.fields){let d=this.getFormFieldAttributes(o);l.push(d)}i.push({id:a.uid,uid:a.uid,name:a.name,sortOrder:null,userCondition:null,elementCondition:null,fields:l})}return e.tabs=i,JSON.stringify(e)},getFormFieldAttributes(t){const{uiSettings:e,...i}=t;return i},getTabIndexByTabUid(t){return window.FormBuilder.tabs.findIndex(e=>e.uid===t)},addTab(){let t=Craft.uuid(),e={uid:t,name:"New Page",userCondition:null,elementCondition:null,fields:[]};this.tabs.push(e),this.selectedTabUid=t},editTab(t){let e=this,i=window.FormBuilder;i.editTabUid=t.uid;let a=new Craft.CpScreenSlideout("sprout-module-forms/form-builder/edit-form-tab-slideout-via-cp-screen",{hasTabs:!1,params:{formId:i.formId,tab:t}});const l=this.getRemoveButtonHtml();a.$footer.find(".flex-grow").before(l),a.$footer.find(".submit").addClass("secondary"),l.on("click",()=>{if(i.tabs.length===1){Craft.cp.displayNotice(Craft.t("sprout-module-forms","Form must contain at least one tab."));return}let o=e.getTabIndexByTabUid(i.selectedTabUid),d=o-1>=0?i.tabs[o-1].uid:i.tabs[o+1].uid;i.tabs.splice(o,1);let r=e.getTabIndexByTabUid(d);i.selectedTabUid=i.tabs[r].uid,i.editTabUid=i.selectedTabUid,a.close()}),a.on("submit",o=>{this.updateTab(i.editTabUid,o.response.data.tab)}),a.on("close",()=>{i.editTabUid=null})},updateTab(t,e){let i=window.FormBuilder,a=this.getTabIndexByTabUid(t);Object.entries(e).forEach(([l,o])=>{i.tabs[a][l]=o}),i.tabs[a].name||(i.tabs[a].name="Page")},updateTabPosition(t,e=null){let i=window.FormBuilder,a=this.getTabIndexByTabUid(e),l=this.getTabIndexByTabUid(t),o=i.tabs[l];i.tabs.splice(l,1),e?i.tabs.splice(a,0,o):i.tabs.push(o),i.lastUpdatedTabUid=o.uid},getFieldIndexByFieldUid(t,e){return t.fields.findIndex(i=>i.fieldUid===e)},getFieldByType(t){return window.FormBuilder.sourceFields.filter(e=>e.field.type===t)[0]??null},addFieldToLayoutTab(t,e=null){let i=window.FormBuilder,a=this.getFieldByType(t);a.field.type=t,i.dragOrigin===i.DragOrigins.sourceField&&(a.field.name=a.uiSettings.displayName,a.field.handle=a.uiSettings.defaultHandle+"_"+Craft.randomString(4),a.field.uid=Craft.uuid()),i.dragOrigin,i.DragOrigins.layoutField;let l=a.field.uid,o=this.getTabIndexByTabUid(i.selectedTabUid),d=this.getLayoutElement(l,a.field,a.uiSettings);if(i.tabs[o].fields.push(d),e){let r=this.getTabIndexByTabUid(i.selectedTabUid),n=i.tabs[r],s=this.getFieldIndexByFieldUid(n,l),u=n.fields[s];n.fields.splice(s,1);let g=this.getFieldIndexByFieldUid(n,e);n.fields.splice(g,0,u),i.tabs[r]=n}},getLayoutElement(t,e,i){return{type:"BarrelStrength\\Sprout\\forms\\submissions\\CustomFormField",required:!1,width:100,uid:Craft.uuid(),userCondition:null,elementCondition:null,fieldUid:t,field:e,uiSettings:i}},editFieldLayoutElement(t){let e=window.FormBuilder;e.editFieldUid=t.fieldUid;let i=new Craft.CpScreenSlideout("sprout-module-forms/form-builder/edit-form-field-slideout-via-cp-screen",{hasTabs:!0,tabManager:"",params:{formId:e.formId,layoutElement:t}});const a=this.getRemoveButtonHtml();i.$footer.find(".flex-grow").before(a),i.$footer.find(".submit").addClass("secondary"),a.on("click",()=>{this.deleteFieldLayoutElement(t.fieldUid),i.close()}),i.on("submit",l=>{this.updateFieldLayoutElement(e.editFieldUid,l.response.data.layoutElement)}),i.on("close",()=>{e.editFieldUid=null})},updateFieldLayoutElement(t,e){let i=window.FormBuilder,a=this.getTabIndexByTabUid(i.selectedTabUid),l=i.tabs[a],o=this.getFieldIndexByFieldUid(l,t),d=l.fields[o];d.required=e.required,d.field.name=e.field.name,d.field.handle=e.field.handle,d.field.instructions=e.field.instructions,Object.entries(e.field.settings).forEach(([r,n])=>{d.field.settings[r]=n}),l.fields[o]=d},updateFieldLayoutElementPosition(t,e,i,a=null){let l=window.FormBuilder,o=this.getTabIndexByTabUid(t),d=l.tabs[o],r=this.getTabIndexByTabUid(e),n=l.tabs[r];n||(n=d);let s=this.getFieldIndexByFieldUid(d,i),u=d.fields[s];if(d.fields.splice(s,1),a){let g=this.getFieldIndexByFieldUid(n,a);n.fields.splice(g,0,u)}else n.fields.push(u);l.tabs[r]=n},deleteFieldLayoutElement(t){let e=this.getTabIndexByTabUid(FormBuilder.selectedTabUid),i=FormBuilder.tabs[e],a=this.getFieldIndexByFieldUid(i,t);FormBuilder.tabs[e].fields.splice(a,1)},resetLastUpdated(){setTimeout(function(){window.FormBuilder.lastUpdatedFormFieldUid=null},300)},getRemoveButtonHtml:function(){const t=Craft.ui.createButton({class:"icon",label:Craft.t("app","Remove"),spinner:!0});return t.attr("data-icon","trash"),t}},T=t=>({DragDropHelper:F,FieldLayoutHelper:y,formId:t,lastUpdatedFormFieldUid:null,sourceFields:[],tabs:[],fieldLayoutUid:null,selectedTabUid:null,editTabUid:null,editFieldUid:null,dragOrigin:null,DragOrigins:{sourceField:"source-field",layoutField:"layout-field",layoutTabNav:"layout-tab-nav"},isDraggingTabUid:null,isDragOverTabUid:null,isDraggingFormFieldUid:null,isDragOverFormFieldUid:null,init(){let e=this;Craft.sendActionRequest("POST","sprout-module-forms/form-builder/get-submission-field-layout",{data:{formId:this.formId}}).then(a=>{e.tabs=a.data.layout.tabs,e.fieldLayoutUid=a.data.layout.uid,e.selectedTabUid=e.tabs[0].uid??null}).catch(()=>{}),window.FormBuilder=this;let i=JSON.parse(this.$refs.formBuilder.dataset.sourceFields);for(const a of i)this.sourceFields.push(a)},getFieldsByGroup(e){return window.FormBuilder.sourceFields.filter(i=>i.groupName===e)}}),h=t=>({element:t,dragHover:!1,init(){},sourceHtml(){return`<div
class="source-field"
draggable="true"
x-bind:class="[dragHover ? 'drag-hover' : '', element.field.sortOrder % 2 == 0 ? 'even' : 'odd']"
x-on:mouseover="dragHover = true"
x-on:mouseleave="dragHover = false"
x-on:dragstart.self="DragDropHelper.dragStartSourceField"
x-on:dragend.self="DragDropHelper.dragEndSourceField"
x-bind:data-type="element.field.type"><h3><span x-html="element.uiSettings.icon" class="sproutforms-icon"></span><span x-text="element.field.name" x-bind:data-handle="element.field.name" class="sproutforms-sourcefield-name"></span></h3></div>`}});window.Alpine=m;m.data("FormBuilder",T);m.data("FormField",h);m.start();let c=window.Sprout||{};c.formNameForm=function(){let t=$("#form-name-form"),e=document.getElementById("name-field");t.on("submit",()=>e.value.length===0?(Garnish.shake(t),e.focus(),!1):(t.submit(),!0))};document.readyState!=="loading"?c.formNameForm():document.addEventListener("DOMContentLoaded",c.formNameForm);/*
 * @link https://sprout.barrelstrengthdesign.com
 * @copyright Copyright (c) Barrel Strength Design LLC
 * @license https://craftcms.github.io/license
 */class w{constructor(e){}disableOptions(){const e=this,a={integrationId:$("#integrationId").val()};return Craft.postActionRequest("sprout-module-forms/form-integration-settings/get-source-form-fields",a,$.proxy(function(l,o){if(o==="success"&&l.success){const r=l.sourceFormFields;$("tbody .formField").each(function(n){const s=$(this);s.empty();const u=r[n].label,g=r[n].value;s.append('<div style="display:none;"><select readonly name="settings['+e.integrationType+"][fieldMapping]["+n+'][sourceFormField]"><option selected value="'+g+'">'+u+'</option></select></div><div style="padding: 7px 10px;font-size: 12px;color:#8f98a3;">'+u+' <span class="code">('+g+")</span></div>")})}else Craft.cp.displayError(Craft.t("sprout","Unable to get the Form fields"))},this)),null}updateAllFieldSelects(){const i="table#settings-"+this.integrationType.replace(/\\/g,"-")+"-fieldMapping tr";$(i).find("td:eq(2),th:eq(2)").remove(),$(i).find("td:eq(0),th:eq(0)").css("width","50%"),$(i).find("td:eq(1),th:eq(1)").css("width","50%");const a=this.getCurrentRows("tbody .targetFields"),l=$("#integrationId").closest("form").serialize(),o=this;Craft.sendActionRequest("POST","sprout-module-forms/form-integration-settings/get-target-integration-fields",{data:l}).then(d=>{if(textStatus==="success"&&d.success){const n=d.targetIntegrationFields;if(n.length===0)return!1;a.each(function(s){const u=$(this).find("select"),g=n[s];o.appendFieldsToSelect(u,g)})}else Craft.cp.displayError(Craft.t("sprout","Unable to get the Form fields"))},this)}getCurrentRows(e=null){return e===null&&(e="tbody .formField"),$(e)}appendFieldsToSelect(e,i){e.empty();let a="",l=!1;e.append('<option value="">'+Craft.t("sprout","None")+"</option>");for(let o=0;o<i.length;o++){const d=i[o];let r="";const n=o===i.length-1;"optgroup"in d||("selected"in d&&(r="selected"),a+="<option "+r+' value="'+d.value+'">'+d.label+"</option>"),("optgroup"in d&&l||n&&l)&&(a+="</optgroup>",l=!1),"optgroup"in d&&(a+='<optgroup label="'+d.optgroup+'">',l=!0)}e.append(a)}}window.SproutFormsIntegration=w;class S{constructor(e,i){this.formId=e,this.siteId=i,this.newSelectField=document.getElementById("new-integration"),this.initLinkSlideout(),this.initNewSlideout()}initLinkSlideout(){let e=this;document.querySelectorAll("#integrations-field .edit-element-col a").forEach(function(a){a.addEventListener("click",function(l){l.preventDefault(),l.target.closest("tr").getAttribute("data-element-id"),Craft.createElementEditor("BarrelStrength\\Sprout\\datastudio\\components\\elements\\DataSetElement",{elementId,siteId:this.siteId,elementType:"BarrelStrength\\Sprout\\datastudio\\components\\elements\\DataSetElement"}).on("submit",()=>{e.replaceTable()})})})}initNewSlideout(){let e=this;if(this.newSelectField){let i=Craft.uuid();this.newSelectField.addEventListener("change",function(a){a.target.value&&e.createSlideout(i,a.target.value)})}}createSlideout(e,i){let a=this,l=window.FormBuilder,o=l.integrationsFormFieldMetadata.length>0?JSON.parse(l.integrationsFormFieldMetadata):[];Craft.sendActionRequest("POST","sprout-module-forms/form-integrations/edit-integration-slideout",{data:{formId:a.formId,integrationUid:e,integrationTypeUid:i,integrationsFormFieldMetadata:o}}).then(d=>{if(d.data.success){const r=new Craft.Slideout(d.data.html,{containerElement:"form",containerAttributes:{action:"sprout-module-forms/form-integration-settings/save-integration",method:"post",novalidate:"",class:"fld-element-settings"}});Craft.appendBodyHtml(d.data.slideoutJs),r.on("submit",()=>{a.replaceTable()}),r.on("close",()=>{this.newSelectField&&(this.newSelectField.value="")})}})}replaceTable(){let e=this;Craft.sendActionRequest("POST","sprout-module-forms/form-integrations/edit-integration-slideout",{data:{elementId:e.elementId}}).then(i=>{$("#integrations-field").html(i.data.html),e.initLinkSlideout(),e.initNewSlideout()})}}window.IntegrationsRelationsTable=S;class B{constructor(e,i){this.elementId=e,this.siteId=i,this.initLinkElementSlideout(),this.initNewElementSlideout()}initLinkElementSlideout(){let e=this;document.querySelectorAll("#data-source-relations-field .edit-element-col a").forEach(function(a){a.addEventListener("click",function(l){l.preventDefault();let o=l.target.closest("tr").getAttribute("data-element-id");Craft.createElementEditor("BarrelStrength\\Sprout\\datastudio\\components\\elements\\DataSetElement",{elementId:o,siteId:this.siteId,elementType:"BarrelStrength\\Sprout\\datastudio\\components\\elements\\DataSetElement"}).on("submit",()=>{e.replaceTable()})})})}initNewElementSlideout(){let e=this,i=document.getElementById("new-data-set");i&&i.addEventListener("change",function(a){Craft.sendActionRequest("POST","sprout-module-data-studio/data-set/create-data-set",{data:{type:a.target.value}}).then(l=>{l.data.success&&Craft.createElementEditor("BarrelStrength\\Sprout\\datastudio\\components\\elements\\DataSetElement",{elementId:l.data.elementId,siteId:l.data.siteId,draftId:l.data.draftId,elementType:"BarrelStrength\\Sprout\\datastudio\\components\\elements\\DataSetElement"}).on("submit",()=>{e.replaceTable()})})})}replaceTable(){let e=this;Craft.sendActionRequest("POST","sprout-module-data-studio/form-relations-table/get-relations-table",{data:{elementId:e.elementId}}).then(i=>{$("#data-source-relations-field").html(i.data.html),e.initLinkElementSlideout(),e.initNewElementSlideout()})}}window.DataSourceRelationsTable=B;class v{constructor(e,i){this.elementId=e,this.siteId=i,this.initLinkElementSlideout(),this.initNewElementSlideout()}initLinkElementSlideout(){let e=this;document.querySelectorAll("#notification-event-relations-field .edit-element-col a").forEach(function(a){a.addEventListener("click",function(l){l.preventDefault();let o=l.target.closest("tr").getAttribute("data-element-id");Craft.createElementEditor("BarrelStrength\\Sprout\\mailer\\components\\elements\\email\\EmailElement",{elementId:o,siteId:this.siteId,elementType:"BarrelStrength\\Sprout\\mailer\\components\\elements\\email\\EmailElement"}).on("submit",()=>{e.replaceTable()})})})}initNewElementSlideout(){let e=this,i=document.getElementById("new-transactional-email");i&&i.addEventListener("change",function(a){Craft.sendActionRequest("POST","sprout-module-mailer/email/create-email",{data:{emailTypeUid:a.target.value,emailVariant:"BarrelStrength\\Sprout\\transactional\\components\\emailvariants\\TransactionalEmailVariant",emailVariantSettings:{eventId:"BarrelStrength\\Sprout\\forms\\components\\notificationevents\\SaveSubmissionNotificationEvent"}}}).then(l=>{l.data.success&&Craft.createElementEditor("BarrelStrength\\Sprout\\mailer\\components\\elements\\email\\EmailElement",{elementId:l.data.elementId,siteId:l.data.siteId,draftId:l.data.draftId,elementType:"BarrelStrength\\Sprout\\mailer\\components\\elements\\email\\EmailElement"}).on("submit",()=>{e.replaceTable()})})})}replaceTable(){let e=this;Craft.sendActionRequest("POST","sprout-module-transactional/form-relations-table/get-relations-table",{data:{elementId:e.elementId}}).then(i=>{$("#notification-event-relations-field").html(i.data.html),e.initLinkElementSlideout(),e.initNewElementSlideout()})}}window.NotificationEventsRelationsTable=v;
//# sourceMappingURL=forms-61fb77ce.js.map
