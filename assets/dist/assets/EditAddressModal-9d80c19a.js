typeof Craft.Sprout>"u"&&(Craft.Sprout={});(function(s){s.extend(Craft.Sprout,{initFields:function(d){s(".sproutaddressinfo-box",d).SproutAddressBox()}}),s.extend(s.fn,{SproutAddressBox:function(){const d=s(this);return this.each(function(){new Craft.Sprout.AddressBox(d)})}}),Craft.Sprout.AddressBox=Garnish.Base.extend({$addressBox:null,$addButtons:null,$editButtons:null,$addressFormat:null,$addButton:null,$updateButton:null,$clearButton:null,$queryButton:null,addressId:null,addressInfo:null,$addressForm:null,countryCode:null,showAddressOnInitialLoad:null,$none:null,modal:null,init:function(d,t){this.$addressBox=d,this.$addButton=this.$addressBox.find(".address-add-button a"),this.$updateButton=this.$addressBox.find(".address-edit-buttons a.update-button"),this.$clearButton=this.$addressBox.find(".address-edit-buttons a.clear-button"),this.$queryButton=s(".query-button"),this.$addButtons=this.$addressBox.find(".address-add-button"),this.$editButtons=this.$addressBox.find(".address-edit-buttons"),this.$addressFormat=this.$addressBox.find(".address-format"),this.settings=t,this.settings.namespace==null&&(this.settings.namespace="address"),this.addressId=this.$addressBox.data("addressId"),this.showAddressOnInitialLoad=this.$addressBox.data("showAddressOnInitialLoad"),this.renderAddress(),this.addListener(this.$addButton,"click","editAddressBox"),this.addListener(this.$updateButton,"click","editAddressBox"),this.addListener(this.$clearButton,"click","clearAddressBox"),this.addListener(this.$queryButton,"click","queryAddressCoordinatesFromGoogleMaps")},renderAddress:function(){this.addressId||this.showAddressOnInitialLoad?(this.$addButtons.addClass("hidden"),this.$editButtons.removeClass("hidden"),this.$addressFormat.removeClass("hidden")):(this.$addButtons.removeClass("hidden"),this.$editButtons.addClass("hidden"),this.$addressFormat.addClass("hidden")),this.$addressForm=this.$addressBox.find(".sproutfields-address-formfields"),this.addressId&&this.getAddressFormFieldsHtml()},editAddressBox:function(d){d.preventDefault(),this.$target=s(d.currentTarget);let t=this.$addressForm.find(".sprout-address-country-select select").val();this.modal=new Craft.Sprout.EditAddressModal(this.$addressForm,{onSubmit:s.proxy(this,"getAddressDisplayHtml"),countryCode:t,namespace:this.settings.namespace},this.$target)},getAddressDisplayHtml:function(d){const t=this;Craft.postActionRequest("sprout-module-fields/fields-address/get-address-display-html",d,s.proxy(function(e){if(e.result===!0)this.$addressBox.find(".address-format").html(e.html),t.$addressForm.empty(),t.$addressForm.append(e.countryCodeHtml),t.$addressForm.append(e.addressFormHtml),t.$addButtons.addClass("hidden"),t.$editButtons.removeClass("hidden"),t.$addressFormat.removeClass("hidden"),this.modal.hide(),this.modal.destroy();else{Garnish.shake(this.modal.$form);let r=e.errors;s.each(r,function(o,a){s.each(a,function(n,i){Craft.cp.displayError(Craft.t("sprout",i))})})}},this),[])},getAddressFormFieldsHtml:function(){const d=this;let t=this.$addressBox.data("addressId"),e=this.$addressBox.data("defaultCountryCode"),r=this.$addressBox.data("addressJson"),o="sprout/fields-address/get-address-form-fields-html",a=this.$addressBox.data("formFieldHtmlActionUrl");a&&(o=a),Craft.postActionRequest(o,{addressId:t,defaultCountryCode:e,addressJson:r},s.proxy(function(n){this.$addressBox.find(".address-format .spinner").remove(),d.$addressBox.find(".address-format").empty(),d.$addressBox.find(".address-format").append(n.html)},this),[])},clearAddressBox:function(d){d.preventDefault();const t=this;this.$addButtons.removeClass("hidden"),this.$editButtons.addClass("hidden"),this.$addressFormat.addClass("hidden"),this.$addressForm.find("[name='"+this.settings.namespace+"[delete]']").val(1),t.addressId=null,this.$addressBox.find(".sprout-address-onchange-country").remove(),this.emptyForm(),this.getAddressFormFieldsHtml()},emptyForm:function(){const d=["countryCode","administrativeArea","locality","dependentLocality","postalCode","sortingCode","address1","address2"],t=this;s.each(d,function(e,r){t.$addressBox.find("[name='"+t.settings.namespace+"["+r+"]']").attr("value","")})},queryAddressCoordinatesFromGoogleMaps:function(d){d.preventDefault();const t=this,e=[];let r=s(".address-format");if(r.each(function(){e.push(s(this).text())}),t.addressInfo=e.join("|"),r.is(":hidden"))return Craft.cp.displayError(Craft.t("sprout","Please add an address")),!1;const o={addressInfo:t.addressInfo};Craft.postActionRequest("sprout-module-fields/fields-address/query-address-coordinates-from-google-maps",o,s.proxy(function(a){if(a.result===!0){const n=a.geo.latitude,i=a.geo.longitude;s("input[name='meta[globals][identity][latitude]']").val(n),s("input[name='meta[globals][identity][longitude]']").val(i),Craft.cp.displayNotice(Craft.t("sprout-module-meta","Latitude and Longitude updated."))}else Craft.cp.displayError(Craft.t("sprout-module-meta","Unable to find the address: "+a.errors))},this),[])}})})(jQuery);typeof Craft.Sprout>"u"&&(Craft.Sprout={});Craft.Sprout.EditAddressModal=Garnish.Modal.extend({id:null,init:function(s,d){this.setSettings(d,Garnish.Modal.defaults),this.$form=$('<form class="sprout-address-modal modal fitted" method="post" accept-charset="UTF-8"/>').appendTo(Garnish.$bod),this.$body=$('<div class="body sprout-address-body"></div>').appendTo(this.$form),this.$bodyMeta=$('<div class="meta"></div>').appendTo(this.$body),this.$addressForm=s,this.$addressFormHtml=s.html(),$(this.$addressFormHtml).appendTo(this.$bodyMeta),this.modalTitle=Craft.t("sprout","Update Address"),this.submitLabel=Craft.t("sprout","Update");let t=$('<div class="footer"/>').appendTo(this.$form),e=$('<div class="btngroup left"/>').appendTo(t),r=$('<div class="btngroup right"/>').appendTo(t);this.$updateBtn=$('<input type="button" class="btn submit" value="'+this.submitLabel+'"/>').appendTo(r),this.$footerSpinner=$('<div class="spinner right hidden"/>').appendTo(t),this.$cancelBtn=$('<input type="button" class="btn" value="'+Craft.t("sprout","Cancel")+'"/>').appendTo(e),this.addListener(this.$cancelBtn,"click","hide"),this.addListener(this.$updateBtn,"click",$.proxy(function(a){a.preventDefault(),this.updateAddress()},this)),this.addListener(".sprout-address-country-select select","change",function(a){this.changeFormInput(a.currentTarget)});let o=this.$form.find(".sprout-address-country-select select");o.val(this.settings.countryCode),this.$form.find(".sprout-address-delete").val()&&o.change(),this.base(this.$form,d)},changeFormInput:function(s){let d=$(s),t=$(s).val(),e=d.parents(".sprout-address-body"),r=this.$addressForm.find(".sprout-address-id").val(),o=this.$addressForm.find(".sprout-address-field-id").val();Craft.postActionRequest("sprout-module-fields/fields-address/update-address-form-html",{addressId:r,fieldId:o,countryCode:t,namespace:this.settings.namespace},$.proxy(function(a){e.find(".sprout-address-onchange-country").remove(),e.find(".sprout-address-delete").first().remove(),e.find(".sprout-address-field-id").first().remove(),e.find(".sprout-address-id").first().remove(),a.html&&e.find(".meta").append(a.html)},this))},enableUpdateBtn:function(){this.$updateBtn.removeClass("disabled")},disableUpdateBtn:function(){this.$updateBtn.addClass("disabled")},showFooterSpinner:function(){this.$footerSpinner.removeClass("hidden")},hideFooterSpinner:function(){this.$footerSpinner.addClass("hidden")},updateAddress:function(){const s=this.settings.namespace;let d=["id","fieldId","countryCode","administrativeAreaCode","locality","dependentLocality","postalCode","sortingCode","address1","address2"];const t={},e=this;$.each(d,function(o,a){t[a]=e.$form.find("[name='"+s+"["+a+"]']").val()});const r={formValues:t};r.namespace=this.settings.namespace,this.settings.onSubmit(r,$.proxy(function(o){$.each(o,function(a,n){let i="<ul class='errors'>";const l=e.$form.find("[name='"+s+"["+a+"]']");l.parent().addClass("errors"),i+="<li>"+n+"</li>",i+="</ul>",l.parent().find(".errors")!=null&&l.parent().find(".errors").remove(),l.after(i)})}))},defaults:{onSubmit:$.noop,onUpdate:$.noop}});
//# sourceMappingURL=EditAddressModal-9d80c19a.js.map
