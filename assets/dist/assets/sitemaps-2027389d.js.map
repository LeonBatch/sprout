{"version":3,"file":"sitemaps-2027389d.js","sources":["../../src/sitemaps/Sitemaps.js"],"sourcesContent":["import './sitemaps.css';\n\n/* global Craft */\n\n/**\n * Manages the dynamic updating of Sitemap attributes from the Sitemap page.\n */\nclass SproutSeoSitemapIndex {\n\n    constructor() {\n        const lightswitches = document.querySelectorAll('.sitemap-settings .lightswitch');\n        const selectDropdowns = document.querySelectorAll('.sitemap-settings select');\n        const customSectionUrls = document.querySelectorAll('.sitemap-settings input.sitemap-custom-url');\n        const customPageDeleteLinks = document.querySelectorAll('#custom-pages tbody tr td a.delete');\n\n        for (const lightswitch of lightswitches) {\n            lightswitch.addEventListener('click', this.updateSitemap);\n        }\n\n        for (const selectDropdown of selectDropdowns) {\n            selectDropdown.addEventListener('change', this.updateSitemap);\n        }\n\n        for (const customSectionUrl of customSectionUrls) {\n            customSectionUrl.addEventListener('change', this.updateSitemap);\n        }\n\n        for (const customPageDeleteLink of customPageDeleteLinks) {\n            customPageDeleteLink.addEventListener('click', this.deleteCustomPage);\n        }\n    }\n\n    updateSitemap(event) {\n        let changedElement = event.target;\n        let $row = $(changedElement).closest('tr');\n        let rowId = $row.data('rowid');\n        let isNew = $row.data('isNew');\n        let enabled = $('input[name=\"sitemaps[sections][' + rowId + '][enabled]\"]').val();\n        let siteId = $('input[name=\"siteId\"]').val();\n        let uri = $('input[name=\"sitemaps[sections][' + rowId + '][uri]\"]').val();\n        let status = $('tr[data-rowid=\"' + rowId + '\"] td span.status');\n\n        let data = {\n            'sitemapMetadataId': $row.data('sitemap-metadata-id'),\n            'type': $row.data('type'),\n            'elementGroupId': $row.data('elementGroupId'),\n            'uri': uri,\n            'priority': $('select[name=\"sitemaps[sections][' + rowId + '][priority]\"]').val(),\n            'changeFrequency': $('select[name=\"sitemaps[sections][' + rowId + '][changeFrequency]\"]').val(),\n            'enabled': enabled,\n            'siteId': siteId,\n        };\n\n        Craft.postActionRequest('sprout-module-sitemaps/sitemaps/save-sitemap-metadata', data, $.proxy(function(response, textStatus) {\n            if (textStatus === 'success') {\n                if (response.success) {\n\n                    let keys = rowId.split('-');\n                    let type = keys[0];\n                    let newRowId = null;\n\n                    if (response.sitemapMetadata.elementGroupId) {\n                        newRowId = type + '-' + response.sitemapMetadata.elementGroupId;\n                    } else {\n                        newRowId = type + '-' + response.sitemapMetadata.id;\n                    }\n\n                    let $changedElementRow = $(changedElement).closest('tr');\n                    let $changedElementTitleLink = $changedElementRow.find('a.sprout-sectiontitle');\n\n                    if ($changedElementRow.data('isNew')) {\n                        $changedElementTitleLink.attr('href', 'sections/' + response.sitemapMetadata.id);\n                        $changedElementRow.removeClass('sitemapsection-isnew');\n                        $changedElementRow.data('isNew', 0);\n                        $changedElementRow.data('sitemapMetadataId', response.sitemapMetadata.id);\n\n                        $changedElementTitleLink.unbind('click');\n                    }\n\n                    let $sectionInputBase = 'input[name=\"sitemaps[sections][' + rowId + ']';\n\n                    $($sectionInputBase + '[id]\"]').val(newRowId);\n                    $($sectionInputBase + '[id]\"]').attr('name', 'sitemaps[sections][' + newRowId + '][id]');\n                    $($sectionInputBase + '[elementGroupId]\"]').attr('name', 'sitemaps[sections][' + newRowId + '][elementGroupId]');\n                    $($sectionInputBase + '[priority]\"]').attr('name', 'sitemaps[sections][' + newRowId + '][priority]');\n                    $($sectionInputBase + '[changeFrequency]\"]').attr('name', 'sitemaps[sections][' + newRowId + '][changeFrequency]');\n                    $($sectionInputBase + '[enabled]\"]').attr('name', 'sitemaps[sections][' + newRowId + '][enabled]');\n\n                    Craft.cp.displayNotice(Craft.t('sprout-module-sitemaps', 'Sitemap metadata saved.'));\n                } else {\n                    Craft.cp.displayError(Craft.t('sprout-module-sitemaps', 'Unable to save Sitemap metadata.'));\n                }\n            }\n        }, this));\n\n        if (enabled) {\n            status.removeClass('disabled');\n            status.addClass('live');\n        } else {\n            status.removeClass('live');\n            status.addClass('disabled');\n        }\n    }\n\n    deleteCustomPage(event) {\n\n        let linkElement = event.target;\n        let row = linkElement.parentElement.parentElement;\n        let customPageId = row.getAttribute('data-sitemap-metadata-id');\n\n        let data = {\n            id: customPageId,\n        };\n\n        Craft.postActionRequest('sprout-module-sitemaps/sitemaps/delete-sitemap-by-id', data, $.proxy(function(response, textStatus) {\n            if (response.success) {\n                row.remove();\n            }\n\n            let customPageRows = document.querySelectorAll('#custom-pages tbody tr').length;\n\n            if (customPageRows <= 0) {\n                let customPagesTable = document.getElementById('custom-pages');\n                customPagesTable.remove();\n            }\n        }, this));\n    }\n}\n\nwindow.SproutSeoSitemapIndex = SproutSeoSitemapIndex;\n"],"names":["SproutSeoSitemapIndex","lightswitches","selectDropdowns","customSectionUrls","customPageDeleteLinks","lightswitch","selectDropdown","customSectionUrl","customPageDeleteLink","event","changedElement","$row","rowId","enabled","siteId","uri","status","data","response","textStatus","type","newRowId","$changedElementRow","$changedElementTitleLink","$sectionInputBase","row"],"mappings":"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"}