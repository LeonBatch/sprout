import{m as y}from"./module.esm-e3630760.js";let T=$("#sprout-relations-modal"),F=new Garnish.Modal(T,{autoShow:!1,closeOtherModals:!1,resizable:!0,onShow:function(){let t={elementId:document.getElementById("sprout-relations-btn").dataset.elementId};Craft.sendActionRequest("POST","sprout-module-core/source-element-relations/get-relations",{data:t}).then(e=>{e.data.success&&T.html(e.data.html)}).catch(()=>{})},onHide:function(){}}),v=document.querySelector("#sprout-relations-btn");v!==null&&v.addEventListener("click",function(a){a.preventDefault(),F.show()},!1);const S=a=>({formId:a,lastUpdatedFormFieldUid:null,sourceFields:[],tabs:[],fields:[],uiSettings:[],fieldLayoutUid:null,selectedTabUid:null,editTabUid:null,editFieldUid:null,dragOrigin:null,DragOrigins:{sourceField:"source-field",layoutField:"layout-field",layoutTabNav:"layout-tab-nav"},isDraggingTabUid:null,isDragOverTabUid:null,isDraggingFormFieldUid:null,isDragOverFormFieldUid:null,init(){let t=this;Craft.sendActionRequest("POST","sprout-module-forms/forms/get-submission-field-layout",{data:{formId:this.formId}}).then(i=>{t.tabs=i.data.layout.tabs,t.fieldLayoutUid=i.data.layout.uid,t.selectedTabUid=t.tabs[0].uid??null}).catch(()=>{}),window.formBuilder=this;let e=JSON.parse(this.$refs.formBuilder.dataset.sourceFields);for(const i of e)this.sourceFields.push(i)},get fieldLayoutInputValue(){let t={};if(this.tabs.length&&!this.tabs[0].elements.length)return[];let e=[];for(const i of this.tabs){let s=[];for(const n of i.elements){let o=this.getFormFieldAttributes(n);s.push(o)}e.push({id:i.uid,uid:i.uid,name:i.name,sortOrder:null,userCondition:null,elementCondition:null,elements:s})}return t.tabs=e,JSON.stringify(t)},getFormFieldAttributes(t){const{uiSettings:e,...i}=t;return i},dragStartLayoutTabNav(t){t.dataTransfer.setData("sprout/origin-page-tab-uid",t.target.dataset.tabUid),this.dragOrigin=this.DragOrigins.layoutTabNav,this.isDraggingTabUid=t.target.dataset.tabUid},dragEndLayoutTabNav(t){this.dragOrigin=null,this.isDraggingTabUid=null,this.isDragOverTabUid=null},dragEnterLayoutTabNav(t){t.target.classList.add("no-pointer-events")},dragLeaveLayoutTabNav(t){t.target.classList.remove("no-pointer-events")},dragOverLayoutTabNav(t){let e=this;this.dragOrigin,this.DragOrigins.layoutTabNav,(this.dragOrigin===this.DragOrigins.sourceField||this.dragOrigin===this.DragOrigins.layoutField)&&setTimeout(function(){e.selectedTabUid=t.target.dataset.tabUid},1e3)},dropOnLayoutTabNav(t){let e=this;t.target.classList.remove("no-pointer-events");let i=t.dataTransfer.getData("sprout/origin-page-tab-uid"),s=t.target.dataset.tabUid;if(this.dragOrigin===this.DragOrigins.layoutTabNav&&(this.updateTabPosition(i,s),this.selectedTabUid=i),this.dragOrigin===this.DragOrigins.sourceField){let n=t.dataTransfer.getData("sprout/field-type");this.addFieldToLayoutTab(n)}this.dragOrigin===this.DragOrigins.layoutField&&this.updateFieldPosition(i,s,e.isDraggingFormFieldUid)},dragStartSourceField(t){this.dragOrigin=this.DragOrigins.sourceField,t.dataTransfer.setData("sprout/field-type",t.target.dataset.type)},dragEndSourceField(t){this.isDraggingFormFieldUid=null,this.isDragOverFormFieldUid=null},dragStartLayoutField(t){t.dataTransfer.setData("sprout/origin-page-tab-uid",this.selectedTabUid),t.dataTransfer.setData("sprout/field-type",t.target.dataset.type),this.dragOrigin=this.DragOrigins.layoutField,this.isDraggingTabUid=t.target.dataset.tabUid,this.isDraggingFormFieldUid=t.target.dataset.fieldUid},dragEndLayoutField(t){this.isDraggingFormFieldUid=null,this.isDragOverFormFieldUid=null},dragEnterLayoutTabBody(t){this.isDragOverTabUid=this.selectedTabUid},dragLeaveLayoutTabBody(t){this.isDragOverTabUid=null},dropOnLayoutTabBody(t){let e=this;t.target.classList.remove("no-pointer-events");let i=t.dataTransfer.getData("sprout/field-type"),s=t.dataTransfer.getData("sprout/origin-page-tab-uid");if(this.dragOrigin===this.DragOrigins.sourceField&&this.addFieldToLayoutTab(i),this.dragOrigin===this.DragOrigins.layoutField){let n=t.target.dataset.fieldUid;this.updateFieldPosition(s,this.selectedTabUid,e.isDraggingFormFieldUid,n)}},dragEnterLayoutField(t){t.target.classList.add("no-pointer-events")},dragLeaveLayoutField(t){t.target.classList.remove("no-pointer-events")},dropOnExistingLayoutField(t){let e=this;t.target.classList.remove("no-pointer-events");let i=t.dataTransfer.getData("sprout/field-type"),s=t.dataTransfer.getData("sprout/origin-page-tab-uid"),n=t.target.dataset.tabUid,o=t.target.dataset.fieldUid;this.dragOrigin===this.DragOrigins.sourceField&&this.addFieldToLayoutTab(i,o),this.dragOrigin===this.DragOrigins.layoutField&&this.updateFieldPosition(s,n,e.isDraggingFormFieldUid,o)},dragEnterFieldLayoutEndZone(t){},dragLeaveFieldLayoutEndZone(t){},dropOnLayoutEndZone(t){let e=this;t.target.classList.remove("no-pointer-events");let i=t.dataTransfer.getData("sprout/field-type"),s=t.dataTransfer.getData("sprout/origin-page-tab-uid"),n=t.target.dataset.tabUid,o=t.target.dataset.fieldUid;this.dragOrigin===this.DragOrigins.sourceField&&this.addFieldToLayoutTab(i),this.dragOrigin===this.DragOrigins.layoutField&&this.updateFieldPosition(s,n,e.isDraggingFormFieldUid,o)},dragOverLayoutTabBody(t){t.dataTransfer.types.includes("sprout/field-type")&&event.preventDefault()},dragOverLayoutField(t){t.dataTransfer.types.includes("sprout/field-type")&&event.preventDefault()},isOverFieldLayoutEndZone(t){t.dataTransfer.types.includes("sprout/field-type")&&event.preventDefault()},getFieldsByGroup(t){return this.sourceFields.filter(e=>e.groupName===t)},getFieldByType(t){return this.sourceFields.filter(e=>e.field.type===t)[0]??null},getTabIndexByTabUid(t){return this.tabs.findIndex(e=>e.uid===t)},getFieldIndexByFieldUid(t,e){return t.elements.findIndex(i=>i.fieldUid===e)},updateTabSettings(t,e){let i=this.getTabIndexByTabUid(t);Object.entries(e).forEach(([s,n])=>{this.tabs[i][s]=n}),this.tabs[i].name||(this.tabs[i].name="Page")},updateFieldSettings(t,e){let i=this.getTabIndexByTabUid(this.selectedTabUid),s=this.tabs[i],n=this.getFieldIndexByFieldUid(s,t),o=s.elements[n];o.name=e.name,o.instructions=e.instructions,o.required=e.required,o.settings=e.settings,s.elements[n]=o},updateTabPosition(t,e=null){let i=this.getTabIndexByTabUid(e),s=this.getTabIndexByTabUid(t),n=this.tabs[s];this.tabs.splice(s,1),e?this.tabs.splice(i,0,n):this.tabs.push(n),this.lastUpdatedTabUid=n.uid},updateFieldPosition(t,e,i,s=null){let n=this.getTabIndexByTabUid(t),o=this.tabs[n],l=this.getTabIndexByTabUid(e),r=this.tabs[l];r||(r=o);let d=this.getFieldIndexByFieldUid(o,i),u=o.elements[d];if(o.elements.splice(d,1),s){let g=this.getFieldIndexByFieldUid(r,s);r.elements.splice(g,0,u)}else r.elements.push(u);this.tabs[l]=r,this.lastUpdatedFormFieldUid=u.uid,this.resetLastUpdated()},addFormPageButton(){let t=Craft.uuid(),e={uid:t,name:"New Page",userCondition:null,elementCondition:null,elements:[]};this.tabs.push(e),this.selectedTabUid=t},addFieldToLayoutTab(t,e=null){let i=this.getFieldByType(t);i.field.type=t,this.dragOrigin===this.DragOrigins.sourceField&&(i.field.name=i.uiSettings.displayName,i.field.handle=i.uiSettings.defaultHandle+"_"+Craft.randomString(4),i.field.uid=Craft.uuid()),this.dragOrigin,this.DragOrigins.layoutField;let s=i.field.uid,n=this.getTabIndexByTabUid(this.selectedTabUid),o=this.getLayoutElement(s,i.field,i.uiSettings);if(this.tabs[n].elements.push(o),e){let l=this.getTabIndexByTabUid(this.selectedTabUid),r=this.tabs[l],d=this.getFieldIndexByFieldUid(r,s),u=r.elements[d];r.elements.splice(d,1);let g=this.getFieldIndexByFieldUid(r,e);r.elements.splice(g,0,u),this.tabs[l]=r,this.lastUpdatedFormFieldUid=u.uid,this.resetLastUpdated()}},getLayoutElement(t,e,i){return{type:"BarrelStrength\\Sprout\\forms\\submissions\\CustomFormField",required:!1,width:100,uid:Craft.uuid(),userCondition:null,elementCondition:null,fieldUid:t,field:e,uiSettings:i}},resetLastUpdated(){let t=this;setTimeout(function(){t.lastUpdatedFormFieldUid=null},300)},isBefore(t,e){if(e.parentNode===t.parentNode){for(let i=t.previousSibling;i&&i.nodeType!==9;i=i.previousSibling)if(i===e)return!0}return!1},editFormTab(t){let e=this;this.editTabUid=t.uid,Craft.sendActionRequest("POST","sprout-module-forms/forms/get-form-tab-settings-html",{data:{formId:this.formId,tab:t}}).then(i=>{const s=$("<div/>",{class:"fld-element-settings-body"}),n=$("<div/>",{class:"fields"}).appendTo(s),o=$("<div/>",{class:"fld-element-settings-footer"}),l=Craft.ui.createButton({class:"icon",attr:{"data-icon":"trash"},label:Craft.t("app","Remove"),spinner:!0});l.attr("data-icon","trash");const r=Craft.ui.createButton({data:{trashed:!0},label:Craft.t("app","Close"),spinner:!0}),d=Craft.ui.createSubmitButton({class:"secondary",label:Craft.t("app","Apply"),spinner:!0});l.appendTo(o),$("<div/>",{class:"flex-grow"}).appendTo(o),r.appendTo(o),d.appendTo(o);let u=e.swapPlaceholders(i.data.settingsHtml,i.data.tabUid);$(u).appendTo(n);const g=s.add(o);$(".sprout-conditionbuilder-slideout").remove();const f=new Craft.Slideout(g,{containerElement:"form",containerAttributes:{method:"post",action:"",class:"fld-element-settings slideout sprout-conditionbuilder-slideout",id:"sprout-tab-modal"}}),h=f.$container;let m=e.swapPlaceholders(i.data.tabSettingsJs,i.data.tabUid);Craft.appendBodyHtml(m),h.on("submit",function(c){c.preventDefault();let b=new FormData(h[0]);Craft.sendActionRequest("POST","sprout-module-forms/forms/get-form-tab-object",{data:b}).then(p=>{e.updateTabSettings(e.editTabUid,{name:p.data.name,userCondition:p.data.userCondition,elementCondition:p.data.elementCondition})}),f.close()}),l.on("click",()=>{if(e.tabs.length===1){Craft.cp.displayNotice(Craft.t("sprout-module-forms","Form must contain at least one tab."));return}let c=e.getTabIndexByTabUid(e.selectedTabUid),b=c-1>=0?e.tabs[c-1].uid:e.tabs[c+1].uid;e.tabs.splice(c,1);let p=e.getTabIndexByTabUid(b);e.selectedTabUid=e.tabs[p].uid,e.editTabUid=e.selectedTabUid,f.close()}),r.on("click",()=>{f.close(),e.editFieldUid=null})}).catch(()=>{})},editFormField(t){let e=this;e.editFieldUid=t.fieldUid,Craft.sendActionRequest("POST","sprout-module-forms/forms/get-form-field-settings-html",{data:{formId:this.formId,layoutElement:t}}).then(i=>{const s=$("<div/>",{class:"fld-element-settings-body"}),n=$("<div/>",{class:"fields"}).appendTo(s),o=$("<div/>",{class:"fld-element-settings-footer"}),l=Craft.ui.createButton({class:"icon",attr:{"data-icon":"trash"},label:Craft.t("app","Remove"),spinner:!0});l.attr("data-icon","trash");const r=Craft.ui.createButton({data:{trashed:!0},label:Craft.t("app","Close"),spinner:!0}),d=Craft.ui.createSubmitButton({class:"secondary",label:Craft.t("app","Apply"),spinner:!0});l.appendTo(o),$("<div/>",{class:"flex-grow"}).appendTo(o),r.appendTo(o),d.appendTo(o);let u=e.swapPlaceholders(i.data.settingsHtml,i.data.fieldUid);$(i.data.requiredSettingsHtml).appendTo(n),$(u).appendTo(n),$(i.data.additionalSettingsHtml).appendTo(n);const g=s.add(o);$(".sprout-conditionbuilder-slideout").remove();const f=new Craft.Slideout(g,{containerElement:"form",containerAttributes:{method:"post",action:"",class:"fld-element-settings slideout sprout-conditionbuilder-slideout",id:"sprout-field-modal"}}),h=f.$container;Craft.initUiElements(s);let m=e.swapPlaceholders(i.data.fieldSettingsJs,i.data.fieldUid);Craft.appendBodyHtml(m),h.on("submit",function(c){c.preventDefault();let b=new FormData(h[0]);Craft.sendActionRequest("POST","sprout-module-forms/forms/get-form-field-object",{data:b}).then(p=>{e.updateFieldSettings(e.editFieldUid,JSON.parse(p.data.fieldSettings))}),f.close()}),l.on("click",()=>{let c=e.getTabIndexByTabUid(e.selectedTabUid),b=e.tabs[c],p=e.getFieldIndexByFieldUid(b,e.editFieldUid);e.tabs[c].elements.splice(p,1),e.editFieldUid=null,f.close()}),r.on("click",()=>{f.close(),e.editFieldUid=null})}).catch(i=>{})},swapPlaceholders(t,e){const i=`condition${Math.floor(Math.random()*1e6)}`;return t.replace(/__ID__/g,i).replace(/__SOURCE_KEY__(?=-)/g,Craft.formatInputId('"'+e+'"')).replace(/__SOURCE_KEY__/g,e)}}),I=a=>({element:a,dragHover:!1,init(){},sourceHtml(){return`<div
class="source-field"
draggable="true"
x-bind:class="[dragHover ? 'drag-hover' : '', element.field.sortOrder % 2 == 0 ? 'even' : 'odd']"
x-on:mouseover="dragHover = true"
x-on:mouseleave="dragHover = false"
x-on:dragstart.self="dragStartSourceField"
x-on:dragend.self="dragEndSourceField"
x-bind:data-type="element.field.type"><h3><span x-html="element.uiSettings.icon" class="sproutforms-icon"></span><span x-text="element.field.name" x-bind:data-handle="element.field.name" class="sproutforms-sourcefield-name"></span></h3></div>`}});window.Alpine=y;y.data("FormBuilder",S);y.data("FormField",I);y.start();/*
 * @link https://sprout.barrelstrengthdesign.com
 * @copyright Copyright (c) Barrel Strength Design LLC
 * @license https://craftcms.github.io/license
 */typeof Craft.SproutForms>"u"&&(Craft.SproutForms={});(function(a){Craft.SproutForms.FormSettings=Garnish.Base.extend({options:null,modal:null,$lightswitches:null,init:function(){this.initButtons()},initButtons:function(){const t=this;a("a[id^='sproutform-integration']").each(function(e,i){const s=a(i).data("integrationid");s&&t.addListener(a("#sproutform-integration-"+s),"activate","editIntegration")}),this.$lightswitches=a(".sproutforms-integration-row .lightswitch"),this.addListener(this.$lightswitches,"click","onEnableIntegration"),this.modal=Craft.SproutForms.IntegrationModal.getInstance(),this.modal.on("saveIntegration",a.proxy(function(e){const i=e.integration;this.resetIntegration(i)},this)),this.addListener(a("#integrationsOptions"),"change","createDefaultIntegration")},onEnableIntegration:function(t){const e=t.currentTarget,i=e.id;let s=a(e).attr("aria-checked");s=s==="true"?1:0;const n=a("#formId").val(),o={integrationId:i,enabled:s,formId:n};Craft.postActionRequest("sprout-module-forms/form-integrations/enable-integration",o,a.proxy(function(l,r){r==="success"&&l.success?Craft.cp.displayNotice(Craft.t("sprout","Integration updated.")):Craft.cp.displayError(Craft.t("sprout","Unable to update integration"))},this))},resetIntegration:function(t){const e=a("#sproutform-integration-"+t.id),i=a("#integration-enabled-"+t.id),s=t.enabled==="1",n=i.attr("aria-checked")==="true";s!==n&&(i.attr("aria-checked",""+s),s?i.addClass("on"):i.removeClass("on")),e.html(t.name)},createDefaultIntegration:function(t){const e=this,i=a("#sproutforms-integrations-table tbody"),s=a("#integrationsOptions").val(),n=a("#formId").val();if(s==="")return;const o={type:s,formId:n,sendRule:"*"};Craft.postActionRequest("sprout-module-forms/form-integrations/save-integration",o,a.proxy(function(l,r){if(r==="success"){const d=l.integration;i.append('<tr class="field sproutforms-integration-row" id ="sproutforms-integration-row-'+d.id+'"><td class="heading"><a href="#" id ="sproutform-integration-'+d.id+'" data-integrationid="'+d.id+'">'+d.name+'</a></td><td><div class="lightswitch small" tabindex="0" data-value="1" role="checkbox" aria-checked="false" id ="integration-enabled-'+d.id+'"><div class="lightswitch-container"><div class="handle"></div></div><input type="hidden" name="" value=""></div></td></tr>'),e.addListener(a("#sproutform-integration-"+d.id),"activate","editIntegration"),a("#integrationsOptions").val("");const u=a("#integration-enabled-"+d.id);u.lightswitch(),e.addListener(u,"click","onEnableIntegration")}},this))},editIntegration:function(t){const e=t.currentTarget,i=a(e).data("integrationid");this.base(a(e)),this.modal.editIntegration(i)}})})(jQuery);/*
 * @link https://sprout.barrelstrengthdesign.com
 * @copyright Copyright (c) Barrel Strength Design LLC
 * @license https://craftcms.github.io/license
 */class C{constructor(t){const e=this;this.integrationType=typeof t.integrationType<"u"?t.integrationType:"",this.disableOptions(),this.updateAllFieldSelects(),this.updateTargetFieldsOnChange=typeof t.updateTargetFieldsOnChange<"u"?t.updateTargetFieldsOnChange:[],this.updateTargetFieldsOnChange.forEach(function(i){$(i).change(function(){e.updateAllFieldSelects()})})}disableOptions(){const t=this,i={integrationId:$("#integrationId").val()};return Craft.postActionRequest("sprout-module-forms/form-integrations/get-source-form-fields",i,$.proxy(function(s,n){if(n==="success"&&s.success){const l=s.sourceFormFields;$("tbody .formField").each(function(r){const d=$(this);d.empty();const u=l[r].label,g=l[r].value;d.append('<div style="display:none;"><select readonly name="settings['+t.integrationType+"][fieldMapping]["+r+'][sourceFormField]"><option selected value="'+g+'">'+u+'</option></select></div><div style="padding: 7px 10px;font-size: 12px;color:#8f98a3;">'+u+' <span class="code">('+g+")</span></div>")})}else Craft.cp.displayError(Craft.t("sprout","Unable to get the Form fields"))},this)),null}updateAllFieldSelects(){const e="table#settings-"+this.integrationType.replace(/\\/g,"-")+"-fieldMapping tr";$(e).find("td:eq(2),th:eq(2)").remove(),$(e).find("td:eq(0),th:eq(0)").css("width","50%"),$(e).find("td:eq(1),th:eq(1)").css("width","50%");const i=this.getCurrentRows("tbody .targetFields"),s=$("#integrationId").closest("form").serialize(),n=this;Craft.postActionRequest("sprout-module-forms/form-integrations/get-target-integration-fields",s,$.proxy(function(o,l){if(l==="success"&&o.success){const d=o.targetIntegrationFields;if(d.length===0)return!1;i.each(function(u){const g=$(this).find("select"),f=d[u];n.appendFieldsToSelect(g,f)})}else Craft.cp.displayError(Craft.t("sprout","Unable to get the Form fields"))},this))}getCurrentRows(t=null){return t===null&&(t="tbody .formField"),$(t)}appendFieldsToSelect(t,e){t.empty();let i="",s=!1;t.append('<option value="">'+Craft.t("sprout","None")+"</option>");for(let n=0;n<e.length;n++){const o=e[n];let l="";const r=n===e.length-1;"optgroup"in o||("selected"in o&&(l="selected"),i+="<option "+l+' value="'+o.value+'">'+o.label+"</option>"),("optgroup"in o&&s||r&&s)&&(i+="</optgroup>",s=!1),"optgroup"in o&&(i+='<optgroup label="'+o.optgroup+'">',s=!0)}t.append(i)}}window.SproutFormsIntegration=C;/*
 * @link https://sprout.barrelstrengthdesign.com
 * @copyright Copyright (c) Barrel Strength Design LLC
 * @license https://craftcms.github.io/license
 */typeof Craft.SproutForms>"u"&&(Craft.SproutForms={});(function(a){let t=window.MutationObserver||window.WebKitMutationObserver;t||(t=function(){},t.prototype.observe=function(){},t.prototype.disconnect=function(){}),Craft.SproutForms.IntegrationModal=Garnish.Modal.extend({$body:null,$content:null,$main:null,$footer:null,$leftButtons:null,$rightButtons:null,$saveBtn:null,$cancelBtn:null,$deleteBtn:null,$saveSpinner:null,$deleteSpinner:null,$loadSpinner:null,addedDelete:!1,$html:null,$js:null,$css:null,$currentHtml:null,$currentJs:null,$currentCss:null,$observed:null,observer:null,templateLoaded:!1,executedJs:null,loadedCss:null,init:function(e){this.base(),this.setSettings(e,{resizable:!0}),this.$currentHtml=a(),this.$currentJs=a(),this.$currentCss=a(),this.$observed=a(),this.executedJs={},this.loadedCss={},this.observer=new t(a.proxy(function(n){for(let o=0;o<n.length;o++)this.$observed=this.$observed.add(n[o].addedNodes)},this));const i=a('<form class="modal sprout-field-modal" style="display: none; opacity: 0;">').appendTo(Garnish.$bod);this.$body=a('<div class="body">').appendTo(i),this.$content=a('<div class="content">').appendTo(this.$body),this.$main=a('<div class="main">').appendTo(this.$content),this.$footer=a('<div class="footer">').appendTo(i),this.$loadSpinner=a('<div class="spinner big">').appendTo(i),this.$leftButtons=a('<div class="buttons left">').appendTo(this.$footer),this.$rightButtons=a('<div class="buttons right">').appendTo(this.$footer),this.$deleteSpinner=a('<div class="spinner hidden">').appendTo(this.$leftButtons),this.$deleteBtn=a('<div class="btn delete hidden" role="button">').text(Craft.t("sprout","Delete")).appendTo(this.$leftButtons),this.$cancelBtn=a('<div class="btn disabled" role="button">').text(Craft.t("sprout","Cancel")).appendTo(this.$rightButtons),this.$saveBtn=a('<div class="btn submit disabled" role="button">').text(Craft.t("sprout","Save")).appendTo(this.$rightButtons),this.$saveSpinner=a('<div class="spinner hidden">').appendTo(this.$rightButtons),this.setContainer(i),this.$loadSpinner.addClass("hidden");const s={html:"",js:"",css:""};this.initTemplate(s)},initTemplate:function(e){const i=a.proxy(function(s){this.$html=s.$html,this.$js=s.$js,this.$css=s.$css,this.templateLoaded=!0,this.initListeners(),this.visible&&this.initSettings(),this.off("parseTemplate",i)},this);this.on("parseTemplate",i),this.parseTemplate(e)},parseTemplate:function(e){const i=this,s=Garnish.$doc.find("head"),n=a(e.html),o=a(e.js).filter("script"),l=a(e.css).filter("style, link"),r=l.filter("link").prop("async",!0),d=l.filter("style");r.each(function(){const m=a(this),c=m.prop("href");i.loadedCss.hasOwnProperty(c)||(s.append(m),i.loadedCss[c]=m)});const u=o.filter("[src]"),g=o.filter(":not([src])"),f=[];u.each(function(){const c=a(this).prop("src");i.executedJs.hasOwnProperty(c)||(f.push(c),i.executedJs[c]=!0)});const h=function(){i.off("runExternalScripts",h),i.trigger("parseTemplate",{target:this,$html:n,$js:g,$css:d})};a.when(this.runExternalScripts(f)).then(h()),this.$deleteBtn.removeClass("hidden"),this.$saveBtn.removeClass("disabled"),this.$cancelBtn.removeClass("disabled")},runExternalScripts:function(e){let i=e.length;if(i>0)for(let s=0;s<e.length;s++){const n=e[s];(n.indexOf("MatrixConfigurator")>=0||n.indexOf("TableFieldSettings.min.js")>=0||n.indexOf("quill.min.js")>=0||n.indexOf("sproutfields.js")>=0||n.indexOf("EditableTable.js")>=0||n.indexOf("initialize.js")>=0)&&a.getScript(n,a.proxy(function(o,l){l==="success"?(i--,i===0&&this.trigger("runExternalScripts",{target:this})):Craft.cp.displayError(Craft.t("sprout","Could not load all resources."))},this))}else this.trigger("runExternalScripts",{target:this})},initListeners:function(){this.$deleteBtn.addClass("hidden"),this.$cancelBtn.addClass("disabled"),this.$saveBtn.addClass("disabled"),this.addListener(this.$cancelBtn,"activate","closeModal"),this.addListener(this.$saveBtn,"activate","saveIntegration"),this.addedDelete||(this.addListener(this.$deleteBtn,"click","deleteIntegration"),this.addedDelete=!0),this.on("show",this.initSettings),this.on("fadeOut",this.destroySettings),this.enable()},destroyListeners:function(){this.$cancelBtn.addClass("disabled"),this.$saveBtn.addClass("disabled"),this.removeListener(this.$cancelBtn,"activate"),this.removeListener(this.$saveBtn,"activate"),this.off("show",this.initSettings),this.off("fadeOut",this.destroySettings),this.disable()},initSettings:function(e){const i=e&&e.target?e.target:this;if(!i.templateLoaded)return;i.$currentHtml=e&&e.$html?e.$html:i.$html.clone(),i.$currentJs=e&&e.$js?e.$js:i.$js.clone(),i.$currentCss=e&&e.$css?e.$css:i.$css.clone(),i.$observed=a(),i.observer.observe(Garnish.$bod[0],{childList:!0,subtree:!1}),i.$main.append(i.$currentHtml),Garnish.$bod.append(i.$currentJs),Craft.initUiElements();const s=function(){i.off("runExternalScripts",s),setTimeout(function(){i.observer.disconnect()},1)};a.when(i.runExternalScripts(Object.keys(i.executedJs))).then(s())},destroySettings:function(e){const i=e&&e.target?e.target:this;i.$currentHtml.remove(),i.$currentJs.remove(),i.$currentCss.remove(),i.$observed.remove()},closeModal:function(){this.hide()},saveIntegration:function(e){if(e&&e.preventDefault(),this.$saveBtn.hasClass("disabled")||!this.$saveSpinner.hasClass("hidden"))return;this.destroyListeners(),this.$saveSpinner.removeClass("hidden");const i=this.$container.serialize(),s=this.$container.find('input[name="integrationId"]');s.length&&s.val(),Craft.postActionRequest("sprout-module-forms/form-integrations/save-integration",i,a.proxy(function(n,o){this.$saveSpinner.addClass("hidden");const l=o==="success";if(l&&n.success)this.initListeners(),this.trigger("saveIntegration",{target:this,integration:n.integration}),Craft.cp.displayNotice(Craft.t("sprout","'{name}' integration saved.",{name:n.integration.name})),this.hide();else if(l&&n.template)if(this.visible){const r=a.proxy(function(d){this.initListeners(),this.destroySettings(),this.initSettings(d),this.off("parseTemplate",r)},this);this.on("parseTemplate",r),this.parseTemplate(n.template),Garnish.shake(this.$container)}else this.initListeners();else this.initListeners(),Craft.cp.displayError(Craft.t("sprout","An unknown error occurred."))},this))},editIntegration:function(e){this.destroyListeners(),this.show(),this.initListeners(),this.$loadSpinner.removeClass("hidden");const i=a("#formId").val(),s={integrationId:e,formId:i};Craft.postActionRequest("sprout-module-forms/form-integrations/edit-integration",s,a.proxy(function(n,o){this.$loadSpinner.addClass("hidden");const l=o==="success";if(l&&n.success){const r=a.proxy(function(d){this.destroySettings(),this.initSettings(d),this.off("parseTemplate",r)},this);this.on("parseTemplate",r),this.parseTemplate(n.template)}else l&&n.error?(Craft.cp.displayError(n.error),this.hide()):(Craft.cp.displayError(Craft.t("sprout","An unknown error occurred. ")),this.hide())},this))},deleteIntegration:function(e){if(e.preventDefault(),this.confirmDeleteIntegration()){this.destroyListeners();const s=this.$container.serialize(),n=a(this.$container).find('input[name="integrationId"]').val();Craft.postActionRequest("sprout-module-forms",s,a.proxy(function(o,l){l==="success"&&o.success?(Craft.cp.displayNotice(Craft.t("sprout","Integration deleted.")),a("#sproutforms-integration-row-"+n).remove(),this.initListeners(),this.hide()):(Craft.cp.displayError(Craft.t("sprout","Unable to delete integration.")),this.hide())},this))}},confirmDeleteIntegration:function(){return confirm("Are you sure you want to delete this integration and all of it's settings?")},hide:function(){this._disabled||this.base()},destroy:function(){this.base.destroy(),this.destroyListeners(),this.destroySettings(),this.$shade.remove(),this.$container.remove(),this.trigger("destroy")}},{getInstance:function(){return this._instance||(this._instance=new Craft.SproutForms.IntegrationModal),this._instance}})})(jQuery);class U{constructor(t,e){this.elementId=t,this.siteId=e,this.initLinkElementSlideout(),this.initNewElementSlideout()}initLinkElementSlideout(){let t=this;document.querySelectorAll("#data-source-relations-field .edit-element-col").forEach(function(i){i.addEventListener("click",function(s){s.preventDefault();let n=s.target.closest("tr").getAttribute("data-element-id");Craft.createElementEditor("BarrelStrength\\Sprout\\datastudio\\components\\elements\\DataSetElement",{elementId:n,siteId:this.siteId,elementType:"BarrelStrength\\Sprout\\datastudio\\components\\elements\\DataSetElement"}).on("submit",()=>{t.replaceTable()})})})}initNewElementSlideout(){let t=this;document.getElementById("new-data-set").addEventListener("change",function(i){Craft.sendActionRequest("POST","sprout-module-data-studio/data-set/create-data-set",{data:{type:i.target.value}}).then(s=>{s.data.success&&Craft.createElementEditor("BarrelStrength\\Sprout\\datastudio\\components\\elements\\DataSetElement",{elementId:s.data.elementId,siteId:s.data.siteId,draftId:s.data.draftId,elementType:"BarrelStrength\\Sprout\\datastudio\\components\\elements\\DataSetElement"}).on("submit",()=>{t.replaceTable()})})})}replaceTable(){let t=this;Craft.sendActionRequest("POST","sprout-module-forms/forms/get-data-source-relations-table",{data:{elementId:t.elementId}}).then(e=>{$("#data-source-relations-field").html(e.data.html),t.initLinkElementSlideout(),t.initNewElementSlideout()})}}window.DataSourceRelationsTable=U;class L{constructor(t,e){this.elementId=t,this.siteId=e,this.initLinkElementSlideout(),this.initNewElementSlideout()}initLinkElementSlideout(){let t=this;document.querySelectorAll("#notification-event-relations-field .edit-element-col").forEach(function(i){i.addEventListener("click",function(s){s.preventDefault();let n=s.target.closest("tr").getAttribute("data-element-id");Craft.createElementEditor("BarrelStrength\\Sprout\\mailer\\components\\elements\\email\\EmailElement",{elementId:n,siteId:this.siteId,elementType:"BarrelStrength\\Sprout\\mailer\\components\\elements\\email\\EmailElement"}).on("submit",()=>{t.replaceTable()})})})}initNewElementSlideout(){let t=this;document.getElementById("new-transactional-email").addEventListener("change",function(i){Craft.sendActionRequest("POST","sprout-module-mailer/email/create-email",{data:{emailTypeUid:i.target.value,emailVariant:"BarrelStrength\\Sprout\\transactional\\components\\emailvariants\\TransactionalEmailVariant",emailVariantSettings:{eventId:"BarrelStrength\\Sprout\\forms\\components\\notificationevents\\SaveSubmissionNotificationEvent"}}}).then(s=>{s.data.success&&Craft.createElementEditor("BarrelStrength\\Sprout\\mailer\\components\\elements\\email\\EmailElement",{elementId:s.data.elementId,siteId:s.data.siteId,draftId:s.data.draftId,elementType:"BarrelStrength\\Sprout\\mailer\\components\\elements\\email\\EmailElement"}).on("submit",()=>{t.replaceTable()})})})}replaceTable(){let t=this;Craft.sendActionRequest("POST","sprout-module-forms/forms/get-notification-events-relations-table",{data:{elementId:t.elementId}}).then(e=>{$("#notification-event-relations-field").html(e.data.html),t.initLinkElementSlideout(),t.initNewElementSlideout()})}}window.NotificationEventsRelationsTable=L;
//# sourceMappingURL=forms-0e370bdc.js.map
