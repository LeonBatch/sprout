{"version":3,"file":"reCaptchaInvisible-ddc145dc.js","sources":["../../src/forms-frontend/recaptcha_v2_invisible.js"],"sourcesContent":["/**\n * Prepare reCAPTCHA for ALL Sprout Forms on page\n */\nclass SproutFormsGoogleRecaptchaInvisible {\n\n  constructor(settings) {\n    this.siteKey = settings.siteKey;\n    this.size = settings.size ?? null;\n    this.theme = settings.theme ?? null;\n    this.badge = settings.badge ?? null;\n    this.badgePosition = this.invisibleRecaptchaGetBadgePosition(this.badge);\n    this.grecaptcha = settings.grecaptcha;\n\n    this.initRecaptchas();\n  }\n\n  initRecaptchas() {\n    let self = this;\n    let sproutFormsRecaptchaContainers = document.querySelectorAll('.google-recaptcha-container');\n\n    for (let recaptchaContainer of sproutFormsRecaptchaContainers) {\n      let form = recaptchaContainer.closest('form');\n      this.addFormEventListener(form);\n\n      let widgetId = self.grecaptcha.render(recaptchaContainer, {\n        'sitekey': self.siteKey,\n        'theme': self.theme,\n        'badge': self.badgePosition,\n        'size': 'invisible',\n        'callback': () => {\n          let event = self.sproutFormsSubmitEvent;\n          event.detail.submitHandler.handleFormSubmit();\n          self.grecaptcha.reset();\n        },\n        'expired-callback': () => {\n          let event = self.sproutFormsSubmitEvent;\n          event.detail.submitHandler.onFormSubmitCancelledEvent();\n          self.grecaptcha.reset();\n        }\n      });\n\n      form.setAttribute('data-google-recaptcha-widget-id', widgetId);\n\n      let submitButton = form.querySelector('[type=\"submit\"]');\n      let recaptchaInlineTextTerms = form.querySelector('.google-recaptcha-inline-text-terms');\n\n      // Place the reCAPTCHA terms after the submit button\n      if (this.badge === 'inline-text') {\n        submitButton.parentNode.insertBefore(recaptchaInlineTextTerms, submitButton.nextSibling);\n        recaptchaInlineTextTerms.style.display = 'block';\n      } else {\n        submitButton.parentNode.insertBefore(recaptchaContainer, submitButton.nextSibling);\n        recaptchaContainer.style.display = 'block';\n      }\n    }\n  }\n\n  /**\n   * Adds Event Listener to Form submit button to ensure reCAPTCHA gets processed\n   *\n   * @param form\n   */\n  addFormEventListener(form) {\n    let self = this;\n\n    form.addEventListener('onSproutFormsSubmit', function(event) {\n\n      let targetForm = event.target;\n      let widgetId = targetForm.getAttribute('data-google-recaptcha-widget-id');\n\n      // Add the sproutFormsSubmit Event to access later from the grecaptcha callbacks\n      self.sproutFormsSubmitEvent = event;\n\n      // Make sure to run reCAPTCHA before submitting form\n      if (!self.grecaptcha.getResponse(widgetId)) {\n        // Cancel the default Sprout Forms submissions. We'll handle it from here\n        // because we need to wait for our callbacks.\n        event.preventDefault();\n        self.grecaptcha.execute(widgetId);\n      }\n\n    }, false);\n  }\n\n  /**\n   * Normalize 'inline' badge setting\n   *\n   * @param badge\n   * @returns string\n   */\n  invisibleRecaptchaGetBadgePosition(badge) {\n    let inlineBadges = ['inline-badge', 'inline-text'];\n\n    if (inlineBadges.indexOf(badge) >= 0) {\n      return 'inline';\n    }\n\n    return badge;\n  }\n}\n\nwindow.SproutFormsGoogleRecaptchaInvisible = SproutFormsGoogleRecaptchaInvisible;\n"],"names":["SproutFormsGoogleRecaptchaInvisible","settings","self","sproutFormsRecaptchaContainers","recaptchaContainer","form","widgetId","submitButton","recaptchaInlineTextTerms","event","badge"],"mappings":"AAGA,MAAMA,CAAoC,CAExC,YAAYC,EAAU,CACpB,KAAK,QAAUA,EAAS,QACxB,KAAK,KAAOA,EAAS,MAAQ,KAC7B,KAAK,MAAQA,EAAS,OAAS,KAC/B,KAAK,MAAQA,EAAS,OAAS,KAC/B,KAAK,cAAgB,KAAK,mCAAmC,KAAK,KAAK,EACvE,KAAK,WAAaA,EAAS,WAE3B,KAAK,eAAc,CACpB,CAED,gBAAiB,CACf,IAAIC,EAAO,KACPC,EAAiC,SAAS,iBAAiB,6BAA6B,EAE5F,QAASC,KAAsBD,EAAgC,CAC7D,IAAIE,EAAOD,EAAmB,QAAQ,MAAM,EAC5C,KAAK,qBAAqBC,CAAI,EAE9B,IAAIC,EAAWJ,EAAK,WAAW,OAAOE,EAAoB,CACxD,QAAWF,EAAK,QAChB,MAASA,EAAK,MACd,MAASA,EAAK,cACd,KAAQ,YACR,SAAY,IAAM,CACJA,EAAK,uBACX,OAAO,cAAc,mBAC3BA,EAAK,WAAW,OACjB,EACD,mBAAoB,IAAM,CACZA,EAAK,uBACX,OAAO,cAAc,6BAC3BA,EAAK,WAAW,OACjB,CACT,CAAO,EAEDG,EAAK,aAAa,kCAAmCC,CAAQ,EAE7D,IAAIC,EAAeF,EAAK,cAAc,iBAAiB,EACnDG,EAA2BH,EAAK,cAAc,qCAAqC,EAGnF,KAAK,QAAU,eACjBE,EAAa,WAAW,aAAaC,EAA0BD,EAAa,WAAW,EACvFC,EAAyB,MAAM,QAAU,UAEzCD,EAAa,WAAW,aAAaH,EAAoBG,EAAa,WAAW,EACjFH,EAAmB,MAAM,QAAU,QAEtC,CACF,CAOD,qBAAqBC,EAAM,CACzB,IAAIH,EAAO,KAEXG,EAAK,iBAAiB,sBAAuB,SAASI,EAAO,CAG3D,IAAIH,EADaG,EAAM,OACG,aAAa,iCAAiC,EAGxEP,EAAK,uBAAyBO,EAGzBP,EAAK,WAAW,YAAYI,CAAQ,IAGvCG,EAAM,eAAc,EACpBP,EAAK,WAAW,QAAQI,CAAQ,EAGnC,EAAE,EAAK,CACT,CAQD,mCAAmCI,EAAO,CAGxC,MAFmB,CAAC,eAAgB,aAAa,EAEhC,QAAQA,CAAK,GAAK,EAC1B,SAGFA,CACR,CACH,CAEA,OAAO,oCAAsCV"}