{"version":3,"file":"sendEmailModal-b4fede1a.js","sources":["../../src/mailer/SendEmailModal.js"],"sourcesContent":["import './send-email-modal.scss';\n\nwindow.SendEmailModal = function(emailId) {\n\n    let $target = $('.sprout-send-email-btn[data-email-id=\"' + emailId + '\"]');\n\n    let getSendEmailHtmlAction = $target.data('get-send-email-html-action');\n    let sendEmailAction = $target.data('send-email-action');\n\n    let modalTitle = $target.data('modal-title');\n    let modalActionBtnLabel = $target.data('modal-action-btn-label');\n\n    let successMessage = Craft.t('sprout-module-mailer', 'Email sent.');\n    let failMessage = Craft.t('sprout-module-mailer', 'Unable to send email.');\n\n    Craft.sendActionRequest('POST', getSendEmailHtmlAction, {\n            data: {\n                emailId: emailId,\n            },\n        })\n        .then((response) => {\n            if (response.data.success) {\n\n                // Form Modal\n                let $form = $('<form/>', {\n                    class: 'modal prompt',\n                }).appendTo(\n                    Garnish.$bod,\n                );\n\n                // Header\n                let $header = $('<div/>', {class: 'header'}).appendTo($form);\n                $('<h2/>', {\n                    text: modalTitle,\n                }).appendTo($header);\n\n                // Body (provided by Mailer)\n                let $body = $('<div/>', {class: 'body'})\n                    .append(response.data.html)\n                    .appendTo($form);\n                // Hidden Email ID field\n                $('<input/>', {\n                    type: 'hidden',\n                    name: 'emailId',\n                    value: emailId,\n                }).appendTo($body);\n\n                // Footer\n                let $footer = $('<div/>', {\n                    class: 'footer sprout-modal-footer-absolute',\n                }).appendTo($form);\n                let $buttons = $('<div/>', {\n                    class: 'buttons right',\n                }).appendTo($footer);\n                let $cancelBtn = $('<button/>', {\n                    type: 'button',\n                    class: 'btn',\n                    text: Craft.t('sprout-module-mailer', 'Cancel'),\n                }).appendTo($buttons);\n                $('<button/>', {\n                    type: 'submit',\n                    class: 'btn submit sprout-send-btn-bg',\n                    text: modalActionBtnLabel,\n                }).appendTo($buttons);\n\n                // Additional JS (optionally provided by Mailer)\n                Craft.appendBodyHtml(response.data.js);\n\n                let success = false;\n\n                let modal = new Garnish.Modal($form, {\n                    onShow: () => {\n                        setTimeout(() => {\n                            Craft.setFocusWithin($body);\n                        }, 100);\n                    },\n                    onHide: () => {\n                        // if (!success) {\n                        //     reject();\n                        // }\n                    },\n                });\n\n                $form.on('submit', (e) => {\n                    e.preventDefault();\n\n                    let postData = Garnish.getPostData(event.target);\n\n                    Craft.sendActionRequest('POST', sendEmailAction, {\n                            data: Craft.expandPostArray(postData),\n                        })\n                        .then((response) => {\n                            if (response.data.success) {\n                                Craft.cp.displayNotice(successMessage);\n\n                                modal.hide();\n                                modal.destroy();\n                            } else {\n                                Craft.cp.displayError(failMessage);\n\n                                if (response.data.errors) {\n                                    let $errorList = $('<ul/>', {class: 'errors'}).appendTo($body);\n                                    for (let key of Object.keys(response.data.errors)) {\n                                        $('<li/>', {\n                                            text: response.data.errors[key],\n                                        }).appendTo($errorList);\n                                    }\n                                }\n                            }\n                        });\n                });\n\n                $cancelBtn.on('click', () => {\n                    modal.hide();\n                    modal.destroy();\n                });\n            }\n        });\n};"],"names":["emailId","$target","getSendEmailHtmlAction","sendEmailAction","modalTitle","modalActionBtnLabel","successMessage","failMessage","response","$form","$header","$body","$footer","$buttons","$cancelBtn","modal","e","postData","$errorList","key"],"mappings":"AAEA,OAAO,eAAiB,SAASA,EAAS,CAEtC,IAAIC,EAAU,EAAE,yCAA2CD,EAAU,IAAI,EAErEE,EAAyBD,EAAQ,KAAK,4BAA4B,EAClEE,EAAkBF,EAAQ,KAAK,mBAAmB,EAElDG,EAAaH,EAAQ,KAAK,aAAa,EACvCI,EAAsBJ,EAAQ,KAAK,wBAAwB,EAE3DK,EAAiB,MAAM,EAAE,uBAAwB,aAAa,EAC9DC,EAAc,MAAM,EAAE,uBAAwB,uBAAuB,EAEzE,MAAM,kBAAkB,OAAQL,EAAwB,CAChD,KAAM,CACF,QAASF,CACZ,CACb,CAAS,EACA,KAAMQ,GAAa,CAChB,GAAIA,EAAS,KAAK,QAAS,CAGvB,IAAIC,EAAQ,EAAE,UAAW,CACrB,MAAO,cACV,CAAA,EAAE,SACC,QAAQ,IAC5B,EAGoBC,EAAU,EAAE,SAAU,CAAC,MAAO,QAAQ,CAAC,EAAE,SAASD,CAAK,EAC3D,EAAE,QAAS,CACP,KAAML,CAC1B,CAAiB,EAAE,SAASM,CAAO,EAGnB,IAAIC,EAAQ,EAAE,SAAU,CAAC,MAAO,MAAM,CAAC,EAClC,OAAOH,EAAS,KAAK,IAAI,EACzB,SAASC,CAAK,EAEnB,EAAE,WAAY,CACV,KAAM,SACN,KAAM,UACN,MAAOT,CAC3B,CAAiB,EAAE,SAASW,CAAK,EAGjB,IAAIC,EAAU,EAAE,SAAU,CACtB,MAAO,qCAC3B,CAAiB,EAAE,SAASH,CAAK,EACbI,EAAW,EAAE,SAAU,CACvB,MAAO,eAC3B,CAAiB,EAAE,SAASD,CAAO,EACfE,EAAa,EAAE,YAAa,CAC5B,KAAM,SACN,MAAO,MACP,KAAM,MAAM,EAAE,uBAAwB,QAAQ,CAClE,CAAiB,EAAE,SAASD,CAAQ,EACpB,EAAE,YAAa,CACX,KAAM,SACN,MAAO,gCACP,KAAMR,CAC1B,CAAiB,EAAE,SAASQ,CAAQ,EAGpB,MAAM,eAAeL,EAAS,KAAK,EAAE,EAIrC,IAAIO,EAAQ,IAAI,QAAQ,MAAMN,EAAO,CACjC,OAAQ,IAAM,CACV,WAAW,IAAM,CACb,MAAM,eAAeE,CAAK,CAC7B,EAAE,GAAG,CACT,EACD,OAAQ,IAAM,CAIb,CACrB,CAAiB,EAEDF,EAAM,GAAG,SAAWO,GAAM,CACtBA,EAAE,eAAc,EAEhB,IAAIC,EAAW,QAAQ,YAAY,MAAM,MAAM,EAE/C,MAAM,kBAAkB,OAAQd,EAAiB,CACzC,KAAM,MAAM,gBAAgBc,CAAQ,CAChE,CAAyB,EACA,KAAMT,GAAa,CAChB,GAAIA,EAAS,KAAK,QACd,MAAM,GAAG,cAAcF,CAAc,EAErCS,EAAM,KAAI,EACVA,EAAM,QAAO,UAEb,MAAM,GAAG,aAAaR,CAAW,EAE7BC,EAAS,KAAK,OAAQ,CACtB,IAAIU,EAAa,EAAE,QAAS,CAAC,MAAO,QAAQ,CAAC,EAAE,SAASP,CAAK,EAC7D,QAASQ,KAAO,OAAO,KAAKX,EAAS,KAAK,MAAM,EAC5C,EAAE,QAAS,CACP,KAAMA,EAAS,KAAK,OAAOW,CAAG,CAC1E,CAAyC,EAAE,SAASD,CAAU,CAE7B,CAEjC,CAAyB,CACzB,CAAiB,EAEDJ,EAAW,GAAG,QAAS,IAAM,CACzBC,EAAM,KAAI,EACVA,EAAM,QAAO,CACjC,CAAiB,CACJ,CACb,CAAS,CACT"}