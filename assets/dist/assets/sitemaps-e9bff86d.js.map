{"version":3,"file":"sitemaps-e9bff86d.js","sources":["../../src/sitemaps/Sitemaps.js"],"sourcesContent":["import './sitemaps.css';\n\n/* global Craft */\n\n/**\n * Manages the dynamic updating of Sitemap attributes from the Sitemap page.\n */\nclass SproutSeoSitemapIndex {\n\n    constructor() {\n        const lightswitches = document.querySelectorAll('.sitemap-settings .lightswitch');\n        const selectDropdowns = document.querySelectorAll('.sitemap-settings select');\n        const customSectionUrls = document.querySelectorAll('.sitemap-settings input.sitemap-custom-url');\n        const customPageDeleteLinks = document.querySelectorAll('#custom-pages tbody tr td a.delete');\n\n        for (const lightswitch of lightswitches) {\n            lightswitch.addEventListener('click', this.updateSitemap);\n        }\n\n        for (const selectDropdown of selectDropdowns) {\n            selectDropdown.addEventListener('change', this.updateSitemap);\n        }\n\n        for (const customSectionUrl of customSectionUrls) {\n            customSectionUrl.addEventListener('change', this.updateSitemap);\n        }\n\n        for (const customPageDeleteLink of customPageDeleteLinks) {\n            customPageDeleteLink.addEventListener('click', this.deleteCustomPage);\n        }\n    }\n\n    updateSitemap(event) {\n        let changedElement = event.target;\n        let row = changedElement.closest('tr');\n        let sourceKey = row.dataset.sourceKey;\n        let isNew = row.dataset.isNew;\n        let enabled = row.querySelector('.enabled-status input').value;\n        let siteId = document.getElementById('current-site-id').value;\n        let uri = row.querySelector('.sitemap-metadata-uri').value;\n        let status = row.querySelector('span.status');\n\n        let data = {\n            'sitemapMetadataId': row.dataset.sitemapMetadataId,\n            'sourceKey': sourceKey,\n            'type': row.dataset.type,\n            'elementGroupId': row.dataset.elementGroupId,\n            'uri': uri,\n            'priority': row.querySelector('.sitemap-priority select').value,\n            'changeFrequency': row.querySelector('.sitemap-change-frequency select').value,\n            'enabled': enabled,\n            'siteId': siteId,\n        };\n\n        Craft.postActionRequest('sprout-module-sitemaps/sitemap-metadata/save-sitemap-metadata', data, $.proxy(function(response, textStatus) {\n            if (textStatus === 'success') {\n                if (response.success) {\n\n                    let keys = sourceKey.split('-');\n                    let type = keys[0];\n                    let newSourceKey = null;\n\n                    if (response.sitemapMetadata.elementGroupId) {\n                        newSourceKey = type + '-' + response.sitemapMetadata.elementGroupId;\n                    } else {\n                        newSourceKey = type + '-' + response.sitemapMetadata.id;\n                    }\n\n                    let $changedElementRow = $(changedElement).closest('tr');\n                    let $changedElementTitleLink = $changedElementRow.find('a.sprout-sectiontitle');\n\n                    if ($changedElementRow.data('isNew')) {\n                        $changedElementTitleLink.attr('href', 'sections/' + response.sitemapMetadata.id);\n                        $changedElementRow.removeClass('sitemapsection-isnew');\n                        $changedElementRow.data('isNew', 0);\n                        $changedElementRow.data('sitemapMetadataId', response.sitemapMetadata.id);\n\n                        $changedElementTitleLink.unbind('click');\n                    }\n\n                    let $sectionInputBase = 'input[name=\"sitemaps[' + newSourceKey + ']';\n\n                    $($sectionInputBase + '[id]\"]').val(newSourceKey);\n                    $($sectionInputBase + '[id]\"]').attr('name', 'sitemaps[' + newSourceKey + '][id]');\n                    $($sectionInputBase + '[elementGroupId]\"]').attr('name', 'sitemaps[' + newSourceKey + '][elementGroupId]');\n                    $($sectionInputBase + '[priority]\"]').attr('name', 'sitemaps[' + newSourceKey + '][priority]');\n                    $($sectionInputBase + '[changeFrequency]\"]').attr('name', 'sitemaps[' + newSourceKey + '][changeFrequency]');\n                    $($sectionInputBase + '[enabled]\"]').attr('name', 'sitemaps[' + newSourceKey + '][enabled]');\n\n                    Craft.cp.displayNotice(Craft.t('sprout-module-sitemaps', 'Sitemap metadata saved.'));\n                } else {\n                    Craft.cp.displayError(Craft.t('sprout-module-sitemaps', 'Unable to save Sitemap metadata.'));\n                }\n            }\n        }, this));\n\n        if (enabled) {\n            status.classList.remove('disabled');\n            status.classList.add('live');\n        } else {\n            status.classList.remove('live');\n            status.classList.add('disabled');\n        }\n    }\n\n    deleteCustomPage(event) {\n\n        let linkElement = event.target;\n        let row = linkElement.parentElement.parentElement;\n        let customPageId = row.getAttribute('data-sitemap-metadata-id');\n\n        let data = {\n            id: customPageId,\n        };\n\n        Craft.postActionRequest('sprout-module-sitemaps/sitemap-metadata/delete-sitemap-by-id', data, $.proxy(function(response, textStatus) {\n            if (response.success) {\n                row.remove();\n            }\n\n            let customPageRows = document.querySelectorAll('#custom-pages tbody tr').length;\n\n            if (customPageRows <= 0) {\n                let customPagesTable = document.getElementById('custom-pages');\n                customPagesTable.remove();\n            }\n        }, this));\n    }\n}\n\nwindow.SproutSeoSitemapIndex = SproutSeoSitemapIndex;\n"],"names":["SproutSeoSitemapIndex","lightswitches","selectDropdowns","customSectionUrls","customPageDeleteLinks","lightswitch","selectDropdown","customSectionUrl","customPageDeleteLink","event","changedElement","row","sourceKey","enabled","siteId","uri","status","data","response","textStatus","type","newSourceKey","$changedElementRow","$changedElementTitleLink","$sectionInputBase"],"mappings":"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"}