import{m as g}from"./module.esm-e3630760.js";let f=$("#sprout-relations-modal"),F=new Garnish.Modal(f,{autoShow:!1,closeOtherModals:!1,resizable:!0,onShow:function(){let e={elementId:document.getElementById("sprout-relations-btn").dataset.elementId};Craft.sendActionRequest("POST","sprout-module-core/source-element-relations/get-relations",{data:e}).then(i=>{i.data.success&&f.html(i.data.html)}).catch(()=>{})},onHide:function(){}}),p=document.querySelector("#sprout-relations-btn");p!==null&&p.addEventListener("click",function(t){t.preventDefault(),F.show()},!1);const b={dragStartLayoutTabNav:function(t){t.dataTransfer.setData("sprout/origin-page-tab-uid",t.target.dataset.tabUid),window.FormBuilder.dragOrigin=window.FormBuilder.DragOrigins.layoutTabNav,window.FormBuilder.isDraggingTabUid=t.target.dataset.tabUid},dragEndLayoutTabNav:function(t){window.FormBuilder.dragOrigin=null,window.FormBuilder.isDraggingTabUid=null,window.FormBuilder.isDragOverTabUid=null},dragEnterLayoutTabNav:function(t){t.target.classList.add("no-pointer-events")},dragLeaveLayoutTabNav:function(t){t.target.classList.remove("no-pointer-events")},dragOverLayoutTabNav:function(t){let e=window.FormBuilder;e.dragOrigin,e.DragOrigins.layoutTabNav,(e.dragOrigin===e.DragOrigins.sourceField||e.dragOrigin===e.DragOrigins.layoutField)&&setTimeout(function(){e.selectedTabUid=t.target.dataset.tabUid},1e3)},dropOnLayoutTabNav:function(t){let e=window.FormBuilder,i=e.FieldLayoutHelper;t.target.classList.remove("no-pointer-events");let o=t.dataTransfer.getData("sprout/origin-page-tab-uid"),l=t.target.dataset.tabUid;if(e.dragOrigin===e.DragOrigins.layoutTabNav&&(i.updateTabPosition(o,l),e.selectedTabUid=o),e.dragOrigin===e.DragOrigins.sourceField){let a=t.dataTransfer.getData("sprout/field-type");i.addFieldToLayoutTab(a)}e.dragOrigin===e.DragOrigins.layoutField&&i.updateFieldLayoutElementPosition(o,l,e.isDraggingFormFieldUid)},dragOverLayoutTabBody:function(t){t.dataTransfer.types.includes("sprout/field-type")&&event.preventDefault()},dragLeaveLayoutTabBody:function(t){window.FormBuilder.isDragOverTabUid=null},dragEnterLayoutTabBody:function(t){let e=window.FormBuilder;e.isDragOverTabUid=e.selectedTabUid},dropOnLayoutTabBody:function(t){let e=window.FormBuilder,i=e.FieldLayoutHelper;t.target.classList.remove("no-pointer-events");let o=t.dataTransfer.getData("sprout/field-type"),l=t.dataTransfer.getData("sprout/origin-page-tab-uid");if(e.dragOrigin===e.DragOrigins.sourceField){i.addFieldToLayoutTab(o);let a=i.getFieldByType(o),n=i.getLayoutElement(a.formField.uid,a);i.editFieldLayoutElement(n)}if(e.dragOrigin===e.DragOrigins.layoutField){let a=t.target.dataset.fieldUid;i.updateFieldLayoutElementPosition(l,e.selectedTabUid,e.isDraggingFormFieldUid,a)}},dragStartSourceField:function(t){window.FormBuilder.dragOrigin=window.FormBuilder.DragOrigins.sourceField,t.dataTransfer.setData("sprout/field-type",t.target.dataset.type)},dragEndSourceField:function(t){window.FormBuilder.isDraggingFormFieldUid=null,window.FormBuilder.isDragOverFormFieldUid=null},dragStartLayoutField:function(t){let e=window.FormBuilder;t.dataTransfer.setData("sprout/origin-page-tab-uid",e.selectedTabUid),t.dataTransfer.setData("sprout/field-type",t.target.dataset.type),e.dragOrigin=e.DragOrigins.layoutField,e.isDraggingTabUid=t.target.dataset.tabUid,e.isDraggingFormFieldUid=t.target.dataset.fieldUid},dragEndLayoutField:function(t){window.FormBuilder.isDraggingFormFieldUid=null,window.FormBuilder.isDragOverFormFieldUid=null},dragEnterLayoutField:function(t){t.target.classList.add("no-pointer-events")},dragOverLayoutField:function(t){t.dataTransfer.types.includes("sprout/field-type")&&(window.FormBuilder.isDragOverFormFieldUid=t.target.dataset.fieldUid,event.preventDefault())},dragLeaveLayoutField:function(t){t.target.classList.remove("no-pointer-events")},dropOnExistingLayoutField:function(t){let e=window.FormBuilder,i=e.FieldLayoutHelper;t.target.classList.remove("no-pointer-events");let o=t.dataTransfer.getData("sprout/field-type"),l=t.dataTransfer.getData("sprout/origin-page-tab-uid"),a=t.target.dataset.tabUid,n=t.target.dataset.fieldUid;e.dragOrigin===e.DragOrigins.sourceField&&i.addFieldToLayoutTab(o,n),e.dragOrigin===e.DragOrigins.layoutField&&i.updateFieldLayoutElementPosition(l,a,e.isDraggingFormFieldUid,n)},dragEnterFieldLayoutEndZone:function(t){},dragLeaveFieldLayoutEndZone:function(t){},isOverFieldLayoutEndZone:function(t){t.dataTransfer.types.includes("sprout/field-type")&&event.preventDefault()},dropOnLayoutEndZone:function(t){let e=window.FormBuilder,i=e.FieldLayoutHelper;t.target.classList.remove("no-pointer-events");let o=t.dataTransfer.getData("sprout/field-type"),l=t.dataTransfer.getData("sprout/origin-page-tab-uid"),a=t.target.dataset.tabUid,n=t.target.dataset.fieldUid;e.dragOrigin===e.DragOrigins.sourceField&&i.addFieldToLayoutTab(o),e.dragOrigin===e.DragOrigins.layoutField&&i.updateFieldLayoutElementPosition(l,a,e.isDraggingFormFieldUid,n)}},y={get submissionFieldLayoutConfig(){let t=window.FormBuilder,e={};if(t.tabs.length&&!t.tabs[0].elements.length)return[];let i=[];for(const o of t.tabs){let l=[];for(const a of o.elements){let n=this.getFormFieldAttributes(a);l.push(n)}i.push({id:o.uid,uid:o.uid,name:o.name,sortOrder:null,userCondition:null,elementCondition:null,elements:l})}return e.tabs=i,JSON.stringify(e)},getFormFieldAttributes(t){const{formFieldUi:e,...i}=t;return i},getTabIndexByTabUid(t){return window.FormBuilder.tabs.findIndex(e=>e.uid===t)},addTab(){let t=Craft.uuid(),e={uid:t,name:"New Page",userCondition:null,elementCondition:null,elements:[]};this.tabs.push(e),this.selectedTabUid=t},editTab(t){let e=this,i=window.FormBuilder;i.editTabUid=t.uid;let o=new Craft.CpScreenSlideout("sprout-module-forms/form-builder/edit-form-tab-slideout-via-cp-screen",{hasTabs:!1,params:{formId:i.formId,tab:t}});const l=this.getRemoveButtonHtml();o.$footer.find(".flex-grow").before(l),o.$footer.find(".submit").addClass("secondary"),l.on("click",()=>{if(i.tabs.length===1){Craft.cp.displayNotice(Craft.t("sprout-module-forms","Form must contain at least one tab."));return}let a=e.getTabIndexByTabUid(i.selectedTabUid),n=a-1>=0?i.tabs[a-1].uid:i.tabs[a+1].uid;confirm(Craft.t("sprout-module-forms","All fields and related submission field content will be deleted too. Are you sure you want to continue?")),i.tabs.splice(a,1);let r=e.getTabIndexByTabUid(n);i.selectedTabUid=i.tabs[r].uid,i.editTabUid=i.selectedTabUid,o.close()}),o.on("submit",a=>{this.updateTab(i.editTabUid,a.response.data.tab)}),o.on("close",()=>{i.editTabUid=null})},updateTab(t,e){let i=window.FormBuilder,o=this.getTabIndexByTabUid(t);Object.entries(e).forEach(([l,a])=>{i.tabs[o][l]=a}),i.tabs[o].name||(i.tabs[o].name="Page")},updateTabPosition(t,e=null){let i=window.FormBuilder,o=this.getTabIndexByTabUid(e),l=this.getTabIndexByTabUid(t),a=i.tabs[l];i.tabs.splice(l,1),e?i.tabs.splice(o,0,a):i.tabs.push(a),i.lastUpdatedTabUid=a.uid},getFieldIndexByFieldUid(t,e){return t.elements.findIndex(i=>i.fieldUid===e)},getFieldByType(t){return window.FormBuilder.sourceFields.filter(e=>e.formField.type===t)[0]??null},addFieldToLayoutTab(t,e=null){let i=window.FormBuilder,o=this.getFieldByType(t);o.formField.type=t,i.dragOrigin===i.DragOrigins.sourceField&&(o.formField.name=o.formFieldUi.displayName,o.formField.handle=o.formFieldUi.defaultHandle+"_"+Craft.randomString(4),o.formField.uid=Craft.uuid()),i.dragOrigin,i.DragOrigins.layoutField;let l=o.formField.uid,a=this.getTabIndexByTabUid(i.selectedTabUid),n=this.getLayoutElement(l,o);if(i.tabs[a].elements.push(n),e){let r=this.getTabIndexByTabUid(i.selectedTabUid),d=i.tabs[r],s=this.getFieldIndexByFieldUid(d,l),u=d.elements[s];d.elements.splice(s,1);let m=this.getFieldIndexByFieldUid(d,e);d.elements.splice(m,0,u),i.tabs[r]=d}},getLayoutElement(t,e){return{type:"BarrelStrength\\Sprout\\forms\\submissions\\CustomFormField",required:!1,width:100,uid:Craft.uuid(),userCondition:null,elementCondition:null,fieldUid:t,formField:e.formField,formFieldUi:e.formFieldUi}},editFieldLayoutElement(t){let e=window.FormBuilder;e.editFieldUid=t.fieldUid;let i=new Craft.CpScreenSlideout("sprout-module-forms/form-builder/edit-form-field-slideout-via-cp-screen",{hasTabs:!0,tabManager:"",params:{formId:e.formId,layoutElement:t}});const o=this.getRemoveButtonHtml();i.$footer.find(".flex-grow").before(o),i.$footer.find(".submit").addClass("secondary"),o.on("click",()=>{this.deleteFieldLayoutElement(t.fieldUid),i.close()}),i.on("submit",l=>{this.updateFieldLayoutElement(e.editFieldUid,l.response.data.layoutElement)}),i.on("close",()=>{e.editFieldUid=null})},updateFieldLayoutElement(t,e){let i=window.FormBuilder,o=this.getTabIndexByTabUid(i.selectedTabUid),l=i.tabs[o],a=this.getFieldIndexByFieldUid(l,t),n=l.elements[a];n.required=e.required,n.formField.name=e.formField.name,n.formField.handle=e.formField.handle,n.formField.instructions=e.formField.instructions,Object.entries(e.formField.settings).forEach(([r,d])=>{n.formField.settings[r]=d}),l.elements[a]=n},updateFieldLayoutElementPosition(t,e,i,o=null){let l=window.FormBuilder,a=this.getTabIndexByTabUid(t),n=l.tabs[a],r=this.getTabIndexByTabUid(e),d=l.tabs[r];d||(d=n);let s=this.getFieldIndexByFieldUid(n,i),u=n.elements[s];if(n.elements.splice(s,1),o){let m=this.getFieldIndexByFieldUid(d,o);d.elements.splice(m,0,u)}else d.elements.push(u);l.tabs[r]=d},deleteFieldLayoutElement(t){let e=this.getTabIndexByTabUid(FormBuilder.selectedTabUid),i=FormBuilder.tabs[e],o=this.getFieldIndexByFieldUid(i,t);FormBuilder.tabs[e].elements.splice(o,1)},resetLastUpdated(){setTimeout(function(){window.FormBuilder.lastUpdatedFormFieldUid=null},300)},getRemoveButtonHtml:function(){const t=Craft.ui.createButton({class:"icon",label:Craft.t("app","Remove"),spinner:!0});return t.attr("data-icon","trash"),t}},T=t=>({DragDropHelper:b,FieldLayoutHelper:y,formId:t,lastUpdatedFormFieldUid:null,sourceFields:[],tabs:[],fieldLayoutUid:null,selectedTabUid:null,editTabUid:null,editFieldUid:null,dragOrigin:null,DragOrigins:{sourceField:"source-field",layoutField:"layout-field",layoutTabNav:"layout-tab-nav"},isDraggingTabUid:null,isDragOverTabUid:null,isDraggingFormFieldUid:null,isDragOverFormFieldUid:null,init(){let e=this;Craft.sendActionRequest("POST","sprout-module-forms/form-builder/get-submission-field-layout",{data:{formId:this.formId}}).then(o=>{e.tabs=o.data.layout.tabs,e.fieldLayoutUid=o.data.layout.uid,e.selectedTabUid=e.tabs[0].uid??null}).catch(()=>{}),window.FormBuilder=this;let i=JSON.parse(this.$refs.formBuilder.dataset.sourceFields);for(const o of i)this.sourceFields.push(o)},getFieldsByGroup(e){return window.FormBuilder.sourceFields.filter(i=>i.groupName===e)}}),h=t=>({element:t,dragHover:!1,init(){},sourceHtml(){return`<div
class="source-field"
draggable="true"
x-bind:class="[dragHover ? 'drag-hover' : '', element.formField.sortOrder % 2 == 0 ? 'even' : 'odd']"
x-on:mouseover="dragHover = true"
x-on:mouseleave="dragHover = false"
x-on:dragstart.self="DragDropHelper.dragStartSourceField"
x-on:dragend.self="DragDropHelper.dragEndSourceField"
x-bind:data-type="element.formField.type"><h3><span x-html="element.formFieldUi.icon" class="sproutforms-icon"></span><span x-text="element.formField.name" x-bind:data-handle="element.formField.name" class="sproutforms-sourcefield-name"></span></h3></div>`}});window.Alpine=g;g.data("FormBuilder",T);g.data("FormField",h);g.start();let c=window.Sprout||{};c.formNameForm=function(){let t=$("#form-name-form"),e=document.getElementById("name-field");t.on("submit",()=>e.value.length===0?(Garnish.shake(t),e.focus(),!1):(t.submit(),!0))};document.readyState!=="loading"?c.formNameForm():document.addEventListener("DOMContentLoaded",c.formNameForm);/*
 * @link https://sprout.barrelstrengthdesign.com
 * @copyright Copyright (c) Barrel Strength Design LLC
 * @license https://craftcms.github.io/license
 */class w{constructor(e){}disableOptions(){const e=this,o={integrationId:$("#integrationId").val()};return Craft.postActionRequest("sprout-module-forms/form-integration-settings/get-source-form-fields",o,$.proxy(function(l,a){if(a==="success"&&l.success){const r=l.sourceFormFields;$("tbody .formField").each(function(d){const s=$(this);s.empty();const u=r[d].label,m=r[d].value;s.append('<div style="display:none;"><select readonly name="settings['+e.integrationType+"][fieldMapping]["+d+'][sourceFormField]"><option selected value="'+m+'">'+u+'</option></select></div><div style="padding: 7px 10px;font-size: 12px;color:#8f98a3;">'+u+' <span class="code">('+m+")</span></div>")})}else Craft.cp.displayError(Craft.t("sprout","Unable to get the Form fields"))},this)),null}updateAllFieldSelects(){const i="table#settings-"+this.integrationType.replace(/\\/g,"-")+"-fieldMapping tr";$(i).find("td:eq(2),th:eq(2)").remove(),$(i).find("td:eq(0),th:eq(0)").css("width","50%"),$(i).find("td:eq(1),th:eq(1)").css("width","50%");const o=this.getCurrentRows("tbody .targetFields"),l=$("#integrationId").closest("form").serialize(),a=this;Craft.sendActionRequest("POST","sprout-module-forms/form-integration-settings/get-target-integration-fields",{data:l}).then(n=>{if(textStatus==="success"&&n.success){const d=n.targetIntegrationFields;if(d.length===0)return!1;o.each(function(s){const u=$(this).find("select"),m=d[s];a.appendFieldsToSelect(u,m)})}else Craft.cp.displayError(Craft.t("sprout","Unable to get the Form fields"))},this)}getCurrentRows(e=null){return e===null&&(e="tbody .formField"),$(e)}appendFieldsToSelect(e,i){e.empty();let o="",l=!1;e.append('<option value="">'+Craft.t("sprout","None")+"</option>");for(let a=0;a<i.length;a++){const n=i[a];let r="";const d=a===i.length-1;"optgroup"in n||("selected"in n&&(r="selected"),o+="<option "+r+' value="'+n.value+'">'+n.label+"</option>"),("optgroup"in n&&l||d&&l)&&(o+="</optgroup>",l=!1),"optgroup"in n&&(o+='<optgroup label="'+n.optgroup+'">',l=!0)}e.append(o)}}window.SproutFormsIntegration=w;class B{constructor(e,i){this.formId=e,this.siteId=i,this.newSelectField=document.getElementById("new-integration"),this.initLinkSlideout(),this.initNewSlideout()}initLinkSlideout(){let e=this;document.querySelectorAll("#integrations-field .edit-element-col a").forEach(function(o){o.addEventListener("click",function(l){l.preventDefault(),l.target.closest("tr").getAttribute("data-element-id"),Craft.createElementEditor("BarrelStrength\\Sprout\\datastudio\\components\\elements\\DataSetElement",{elementId,siteId:this.siteId,elementType:"BarrelStrength\\Sprout\\datastudio\\components\\elements\\DataSetElement"}).on("submit",()=>{e.replaceTable()})})})}initNewSlideout(){let e=this;if(this.newSelectField){let i=Craft.uuid();this.newSelectField.addEventListener("change",function(o){o.target.value&&e.createSlideout(i,o.target.value)})}}createSlideout(e,i){let o=this,l=window.FormBuilder,a=l.integrationsFormFieldMetadata.length>0?JSON.parse(l.integrationsFormFieldMetadata):[];Craft.sendActionRequest("POST","sprout-module-forms/form-integrations/edit-integration-slideout",{data:{formId:o.formId,integrationUid:e,integrationTypeUid:i,integrationsFormFieldMetadata:a}}).then(n=>{if(n.data.success){const r=new Craft.Slideout(n.data.html,{containerElement:"form",containerAttributes:{action:"sprout-module-forms/form-integration-settings/save-integration",method:"post",novalidate:"",class:"fld-element-settings"}});Craft.appendBodyHtml(n.data.slideoutJs),r.on("submit",()=>{o.replaceTable()}),r.on("close",()=>{this.newSelectField&&(this.newSelectField.value="")})}})}replaceTable(){let e=this;Craft.sendActionRequest("POST","sprout-module-forms/form-integrations/edit-integration-slideout",{data:{elementId:e.elementId}}).then(i=>{$("#integrations-field").html(i.data.html),e.initLinkSlideout(),e.initNewSlideout()})}}window.IntegrationsRelationsTable=B;class v{constructor(e,i){this.elementId=e,this.siteId=i,this.initLinkElementSlideout(),this.initNewElementSlideout()}initLinkElementSlideout(){let e=this;document.querySelectorAll("#data-source-relations-field .edit-element-col a").forEach(function(o){o.addEventListener("click",function(l){l.preventDefault();let a=l.target.closest("tr").getAttribute("data-element-id");Craft.createElementEditor("BarrelStrength\\Sprout\\datastudio\\components\\elements\\DataSetElement",{elementId:a,siteId:this.siteId,elementType:"BarrelStrength\\Sprout\\datastudio\\components\\elements\\DataSetElement"}).on("submit",()=>{e.replaceTable()})})})}initNewElementSlideout(){let e=this,i=document.getElementById("new-data-set");i&&i.addEventListener("change",function(o){Craft.sendActionRequest("POST","sprout-module-data-studio/data-set/create-data-set",{data:{type:o.target.value}}).then(l=>{l.data.success&&Craft.createElementEditor("BarrelStrength\\Sprout\\datastudio\\components\\elements\\DataSetElement",{elementId:l.data.elementId,siteId:l.data.siteId,draftId:l.data.draftId,elementType:"BarrelStrength\\Sprout\\datastudio\\components\\elements\\DataSetElement"}).on("submit",()=>{e.replaceTable()})})})}replaceTable(){let e=this;Craft.sendActionRequest("POST","sprout-module-data-studio/form-relations-table/get-relations-table",{data:{elementId:e.elementId}}).then(i=>{$("#data-source-relations-field").html(i.data.html),e.initLinkElementSlideout(),e.initNewElementSlideout()})}}window.DataSourceRelationsTable=v;class S{constructor(e,i){this.elementId=e,this.siteId=i,this.initLinkElementSlideout(),this.initNewElementSlideout()}initLinkElementSlideout(){let e=this;document.querySelectorAll("#notification-event-relations-field .edit-element-col a").forEach(function(o){o.addEventListener("click",function(l){l.preventDefault();let a=l.target.closest("tr").getAttribute("data-element-id");Craft.createElementEditor("BarrelStrength\\Sprout\\mailer\\components\\elements\\email\\EmailElement",{elementId:a,siteId:this.siteId,elementType:"BarrelStrength\\Sprout\\mailer\\components\\elements\\email\\EmailElement"}).on("submit",()=>{e.replaceTable()})})})}initNewElementSlideout(){let e=this,i=document.getElementById("new-transactional-email");i&&i.addEventListener("change",function(o){Craft.sendActionRequest("POST","sprout-module-mailer/email/create-email",{data:{emailTypeUid:o.target.value,emailVariant:"BarrelStrength\\Sprout\\transactional\\components\\emailvariants\\TransactionalEmailVariant",emailVariantSettings:{eventId:"BarrelStrength\\Sprout\\forms\\components\\notificationevents\\SaveSubmissionNotificationEvent"}}}).then(l=>{l.data.success&&Craft.createElementEditor("BarrelStrength\\Sprout\\mailer\\components\\elements\\email\\EmailElement",{elementId:l.data.elementId,siteId:l.data.siteId,draftId:l.data.draftId,elementType:"BarrelStrength\\Sprout\\mailer\\components\\elements\\email\\EmailElement"}).on("submit",()=>{e.replaceTable()})})})}replaceTable(){let e=this;Craft.sendActionRequest("POST","sprout-module-transactional/form-relations-table/get-relations-table",{data:{elementId:e.elementId}}).then(i=>{$("#notification-event-relations-field").html(i.data.html),e.initLinkElementSlideout(),e.initNewElementSlideout()})}}window.NotificationEventsRelationsTable=S;
//# sourceMappingURL=forms-310cb492.js.map
